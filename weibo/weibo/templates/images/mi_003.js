MI.TalkBoxRich=1;(function(){var f=UI.G,e=UI.GC;if(!window.MIApp||window.MIApp.lib)window.$=UI.G,window.$$=UI.GC;MI.PicTurn={pos:0,url:"http://upload.t.qq.com",path:"",cache:[],build:function(a){var b=this,c="imageRotate"+MI.random();b.talkBox=a;b._body=UI.html("<div "+(UI.B.ie6?"":'class="big"')+' style="display:none;margin:3px 0 8px;padding:4px;border:1px solid #e5e5e5;background:#f9f9f9;position:absolute;z-index:20;top:15px;left:0px;"><div class="tools"'+("en_US"==window.MILang?'style="width:200px"':'style="width:130px"')+'><a class="btnBack" href="#" style=""><em'+(UI.B.ie6?" style=\"width:17px;background:url('http://mat1.gtimg.com/www/mb/images/b2_100907.png') no-repeat scroll -162px -233px transparent;\"":"")+"></em>"+_("向左转")+'</a><span>|</span><a class="btnPrev" href="#"><em'+(UI.B.ie6?" style=\"width:17px;background:url('http://mat1.gtimg.com/www/mb/images/b2_100907.png') no-repeat scroll -179px -233px transparent;\"":"")+"></em>"+_("向右转")+'</a></div><div class="loading" style="width:112px;line-height:1.231;height:19px;_height:21px;display:none;">'+_("处理中")+'...</div><div class="imgct" style="clear:both;text-align:center;_width:160px;"></div><form method="POST" target="'+c+'" action="/asyn/rotatepic.php"><input type="hidden" id="irRetType" name="retType" value="0" /><input type="hidden" id="irPath" name="path" /><input type="hidden" id="irDegrees" name="degrees" /></form><iframe id="'+c+'" name="'+c+'" src="about:blank" style="display:none"></iframe></div>')[0];b._imgCt=e(b._body,".imgct")[0];b._picLoading=e(b._body,".loading")[0];b._tools=e(b._body,".tools")[0];b._form=e(b._body,"form")[0];e(b._body,".btnPrev")[0].onclick=function(){this.blur();b.turn(1);MI.Bos("btnPicTurn");return!1};e(b._body,".btnBack")[0].onclick=function(){this.blur();b.turn(-1);MI.Bos("btnPicTurn");return!1};b._body.onmouseover=function(){clearTimeout(b.hl);b.show()};b._body.onmouseout=function(){b.hide()};return b._body},turn:function(a){this.pos+=a;3<this.pos?this.pos-=4:0>this.pos&&(this.pos+=4);(a=this.cache[this.pos])?(this.talkBox.pic=a,this.set(a)):this.get()},get:function(){UI.hide(this._tools);this._picLoading.style.display="block";UI.A(this._form,"action",MI.PicTurn.url+"/asyn/rotatepic.php");f("irPath").value=this.path;f("irDegrees").value=90*this.pos;this._form.submit()},over:function(a){0==a.result&&(a=a.info.image,this.talkBox.pic=a,this.cache[this.pos]=a,this.set(a));UI.hide(this._picLoading);UI.show(this._tools)},set:function(a){var b=this;b._imgCt.innerHTML='<img src="'+a+'/160" /><br /><div style="display:'+(UI.B.ipad?"none":"inline")+';white-space:nowrap;"><a href="#" class="useFilter" style="float:none;display:inline-block;padding:5px 0;">'+_("美化图片")+"</a></div>";e(b._imgCt,".useFilter")[0].onclick=function(){MI.app({Base:function(){MI.photoFilter.build(b.url+b.path,"http://api.t.qq.com/asyn/updateGrabPic.php");MI.TalkBox.cur=b.talkBox}});MI.Bos("btnPhotoFilter");MI.Bos2Open("170278","2.0","101");return!1}},show:function(){clearTimeout(this.autoHideDelay);UI.show(this._body)},hide:function(){UI.hide(this._body)},hideT:function(){var a=this;a.hl=setTimeout(function(){a.hide()},200)},reset:function(a,b){this.pos=0;this.path=b;this.cache=[a];this.set(a);UI.hide(this._picLoading);UI.show(this._tools)}};MI.TalkBox.prototype.uploadPic=function(){this.upPic||UI.fireEvent(this._pic,"click");this.upPic._box.style.left="";this.upPic.flashCapture?UI.show(MI.PhotoMultiUpload.loading):(this.upPic.hide(),UI.append(this._uploadPicS,this._sendStatus),!UI.hasClass(this._sendCnt,"hasMedia")&&UI.addClass(this._sendCnt,"hasMedia"),UI.show(this._picLoading),UI.addClass(this._picLoading,"loading"));MI.TalkBox.cur=this};MI.TalkBox.prototype.addLongWB=function(a){var b=this;b.longWB.title=a.title;b.longWB.html=a.html;b.__uploadLongWB||(uploadLongWB='<div class="sendThumbs uploadLongwb"><i class="sico ic_longwb"></i><span class="text">长微博页面</span><a href="#" class="edit_link">[修改]</a></div>',b._uploadLongWB=UI.html(uploadLongWB)[0],e(b._uploadLongWB,".edit_link")[0].onclick=function(a){a=UI.E(a);a.stop();a.prevent();UI.hide(b.longWBSend);UI.removeClass(b.longWBDom,"d_lgwb_form2");UI.show(b.longWBInput);MI.TalkBox.qmEditor=new MI.QmEditor({target:e(b.longWBDom,".edit_frame")[0],value:b.longWB.html||"",height:"322px",callback:function(a){if(UI.B.ie6)var b=setTimeout(function(){UI.C(a._mEditBody,"padding","0");clearTimeout(b)},200);else UI.C(a._mEditBody,"padding","0")},funclist:{toolbar:"Bold Italic Underline | FontName FontSize ForeColor BackColor | AlignMode Serial Indent | CreateLink Photo ScreenSnap"}});MI.Bos("btnLongWBModify")},0==UI.children(b._sendStatus,"sendThumbs").length&&UI.append(b._uploadLongWB,b._sendStatus));!UI.hasClass(b._sendCnt,"hasMedia")&&UI.addClass(b._sendCnt,"hasMedia")};MI.TalkBox.prototype.qbUploadCookie=function(){return document.cookie};MI.TalkBox.prototype.qbUploadPosition=function(){return e(this.upPic._picForm,"input")[0]};MI.TalkBox.prototype.qbUploadAddPic=function(a){a&&(a.info&&!a.info.fileName)&&(a.info.fileName=_("图片.jpg"));this.addPic(a)};MI.TalkBox.prototype.showPicTabs=[];MI.TalkBox.prototype.picTabsConfig={normal:0,multi:0,merge:1,link:2,text:3,camera:4,soso:5};MI.TalkBox.prototype._addMusic=function(a){var b=this,c;if(a.music||a.mlist)a.music&&(b.music=a.music,b.mlist=""),a.mlist&&(b.mlist=a.mlist,b.music=""),b._music&&MI.app({Music:function(){if(b.music&&b.music.id){UI.A(b._music,"music",""+b.music.id+","+b.music.songurl+","+b.music.singer+","+b.music.song+",3");c=2}else if(b.mlist){UI.A(b._music,"music",""+b.mlist.uin+","+b.mlist.url+",,"+b.mlist.name+",3");c=3}MI.Music.addPreview(b._music,"",c);MI.user.fun.nanoMood&&b._mood&&!UI.hasClass(b._mood,"disabled")&&UI.addClass(b._mood,"disabled");MI.Music.hide()}})};MI.TalkBox.prototype.attips=[];MI.TalkBox.prototype.otherCheck=[];MI.TalkBox.prototype.getOtherValue={};MI.TalkBox.prototype.resetOtherValue=[];MI.TalkBox.addNewMsg=function(a,b,c){c._tip&&UI.hide(c._tip);c.add.push(a.info.talk[0].id);a.info.type=c.type;a.info.hasLike=c.hasLike;var d=UI.html((new UI.tmplString(MI.tmpl.listAll))(a.info))[0];c.addEvent(d);UI.addClass(d,"newMsg");b&&(UI.addClass(d,"fill-back"),setTimeout(function(){UI.removeClass(d,"fill-back")},3E4));UI.prepend(d,c._body);c.addFollowBtn(d);c._news.push(d);c.news++;var h=UI.height(d);UI.scrollY();UI.C(d,"height",0);setTimeout(function(){UI.animate(d,"height",h-22,function(){UI.C(d,"height","");c.bottom();MI.Crs(1)},0.3)},0)};MI.TalkBox.prototype._send=function(){var a=this,b,c=1,d=UI.trim(a._txt.value.replace(RegExp(a.txtTopic,"g"),"").replace(RegExp(a.txtKeyword,"g"),"").replace(/＠/g,"@").replace(/＃/g,"#")),h,m,i,n,j=a.upPic;a.tmpl||MI.app({Tmpl:function(){a.tmpl=MI.tmpl.listAll}});MI.TalkBox.cur=a;a.sendCall&&a.sendCall();if(j&&"none"!=UI.C(j._box,"display")){if(a.curPicTab==_("普通模式")&&a.normalPicLoaded&&!a.sendReady){a.sendReady=1;UI.fireEvent(e(j._box,".uploadPicConfirm")[0],"click");return}if((a.curPicTab==_("拼图模式")||a.curPicTab==_("本地上传")||a.curPicTab==_("多图"))&&!a.sendReady&&document.MultiPhoto&&1==document.MultiPhoto.multiPic_picLoaded()&&!MI.TalkBox.cur.multiPicClick){MI.PhotoMultiUpload.upload();a.sendReady=1;return}}for(j=0;j<a.otherCheck.length;j++)if(!a.otherCheck[j]())return;if(!UI.hasClass(a._btn,"btnNoStr"))if(a._btn.disable||UI.hasClass(a._btn,"btnNoStr"))0==a.length&&a.showTip(a.txtTip.empty,1),a._txt.focus(),a._msgTo&&""==UI.trim(a._msgTo.value)&&a._msgTo.focus(),a.sending=0,a.flashTip();else if(a._btn.disable=1,UI.addClass(a._btn,"btnNoStr"),!a.type&&!a.pic&&!a.sourcePic&&!a.topic&&d.match(/^@[a-zA-Z]{1}[\w|-]{0,19}$/g))MI.Bos("btnAtAccountOnly"),MI.user.fun.gotoNanoUserProfile?a.goUser("http://1.t.qq.com/"+d.slice(1)):a.goUser("http://t.qq.com/"+d.slice(1)+"?from=1"),a.reset();else{a.delay.tip=setTimeout(function(){a.showTip(a.txtTipSend,2)},500);a.start&&a.start();b={content:d,startTime:a.startTime,endTime:(new Date).getTime(),countType:a.countType||"",viewModel:a.iconPic||""};a.code&&(b.veriCode=a.code);a.emotion&&(b.emotion=a.emotion);a.pass&&(b.pass=a.pass);a.attips&&(b.attips=a.attips);a.type&&(b.pId=a.talkId,b.type=a.type);a._msgTo&&(b.account=a._msgTo.value.replace(/^@/,""));if(1==b.type||4==b.type||5==b.type){var f=MI.TalkList.rtPics[b.pId],l,k=[];if(f){for(l in f)f.hasOwnProperty(l)&&(f[l]&&"key"!==l)&&k.push(l+":"+f[l]);k.length&&(b.rtpic=k.join(","))}}else a.sourcePic?a.sourcePic.hasString("qpic.cn")?b.pic=a.sourcePic.replace(/\/\d{1,4}$/g,""):b.sourcepic=a.sourcePic:b.pic=a.pic||"";1<a.picsNum&&(b.pic=a.pics.join(","));a.longText&&(b.longText=a.longText);a.longWB&&(MI.Bos("btnSendLongWB"),b.longTitle=a.longWB.title,b.longContent=a.longWB.html);a.topic&&(l=b.content.match(RegExp(MI.string.escapeReg(a.topic)))?"":a.topic,b.content=a.topicAtEnd?b.content+" "+l:l+b.content);a.music&&a.music.id?(b.musicID=a.music.id,b.musicSong=a.music.song,b.musicSinger=a.music.singer,b.musicLocation=a.music.songurl,b.musicShortUrl=a.music.shorturl,a.music.songtype&&(b.musicSource=a.music.songtype)):a.mlist&&(b.mlistUin=a.mlist.uin,b.mlistName=a.mlist.name,b.mlistCnt=a.mlist.num,b.mlistUrl=a.mlist.url,b.mlistPic=a.mlist.pic);a.file&&a.file.uriId&&(b.fileUriId=a.file.uriId,b.fileName=a.file.name,b.fileValidTime=a.file.validTime,b.fileFlag=a.file.flag,b.fileShortUrl=a.file.url);a.video&&(b.video=a.video);a.vid&&(b.vid=a.vid);a.vote&&(b.vote=a.vote,a.resetVote2(a.upVote),a.delVote());a.addCheck&&!b.content.toLocaleLowerCase().hasString(a.addCheck.toLocaleLowerCase())&&(c=0);a.source&&(b.source=a.source);a.apiType?b.apiType=a.apiType:MI.api.type&&(b.apiType=a.apiType=MI.api.type);a.postTxt&&(b.content+=a.postTxt);a.rmsg&&(b.rmsgType=a.rmsg.type,b.rmsgId=a.rmsg.id);a.wqRootId&&(b.qroot=a.wqRootId);a.isAt&&(b.isatpage=1);a.microTpcId?b.mtpcid=a.microTpcId:a.microTpcId2&&(b.subjectid=a.microTpcId2);a.emotion&&b.wqid&&delete b.wqid;l=UI.parseUrl();l.pgv_ref?b.pgv_ref=l.pgv_ref:l.pref&&(b.pgv_ref=l.pref);if(a.getOtherValue)for(j in a.getOtherValue)b[j]=a.getOtherValue[j]();if(a.data){for(j in a.data)b[j]=a.data[j];b.pgv_ref&&a.data.pgv_v&&(b.pgv_ref+=a.data.pgv_v)}h=+new Date;MI.ajax({url:a.url,data:b,success:function(g){m=+new Date-h;clearTimeout(a.delay.timeout);g=MI.json(g);if(MI.user&&g.result==0&&g.info&&UI.isObject(g.info)){var k=g.info.talk[0],j=MI.user;k.pic=j.pic;k.nick=k.nick||j.name;k.name=k.name||j.account;if(a.type!=4)k.chName=k.chName||j.chName;k.flag=k.flag&&UI.isArray(k.flag)?j.flag:k.flag;g.info.iconPic=a.iconPic;g.info.guest=0;g.info.fav=0;for(k=g.info.shield=0;k<a.resetOtherValue.length;k++)a.resetOtherValue[k]();UI.hasClass(a._sendCnt,"hasMedia")&&UI.removeClass(a._sendCnt,"hasMedia")}if(MI.code.check(g.result)){MI.code.show({msg:g.msg,code:g.info,call:function(b){a.code=b;a.send()}});a.reset()}else if(g.result==-104){MI.Bos("btnAtAccountOnlyCN");if(g.info){MI.user.fun.gotoNanoUserProfile?a.goUser("http://1.t.qq.com/"+g.info):a.goUser("http://t.qq.com/"+g.info+"?from=1");a.reset()}}else if(g.result==-103){var f=[];UI.isArray(g.info)&&UI.each(g.info,function(a){UI.isString(a)&&f.push(a.slice(1))});MI.app({Base:function(){MI.confirm({title:_("确定继续发送？"),content:_("你在广播中@到了{0}，可能忘了添加空格，因此未成功@到正确账号。","“"+f.join("”、“")+"”"),confirmTxt:_("继续发送"),confirm:function(){MI.dialog.hide();a.pass=g.result;a.send();MI.Bos("btnSendAtConfirm");a.emotion&&MI.Mood.floatBox.show();a.QX&&MI.Gift&&MI.Gift.buildTalk()},cancelTxt:_("返回修改"),cancel:function(){a.emotion&&MI.Mood.floatBox.show();a.QX&&MI.Gift&&MI.Gift.buildTalk();if(UI.isArray(g.info)&&UI.isString(g.info[0])){var b=a._txt.value.indexOf(g.info[0]);if(b!=-1){b=b+g.info[0].length;MI.selectTxt(a._txt,b,b,b)}else a.focus()}MI.Bos("btnSendAtCancel")}});a.reset()}})}else if(g.result==-206||g.result==-207||g.result==-208||g.result==-210){var f=[],l=[];if(UI.isArray(g.info)){UI.each(g.info,function(a){f.push(a);l.push(_("“")+a+_("”"))});l.join(_("、"))}switch(g.result){case -206:l=_("您在广播中@*到群{0}，可能输入有误，这个群不存在，请返回修改。",l);break;case -207:l=_('您在广播中@*到群{0}，您还不是这个群的成员，请<a href="http://qun.t.qq.com/'+f[0]+'" target="_blank">点击这里</a>先加入这个群，或者返回修改。',l);break;case -208:l=_("不能从私密群转发消息，这条广播将不会被转发。");break;case -210:l=_("您在广播中@到了{0}，目前私密群不支持@非本群成员，他将不会收到提醒。",l)}MI.app({Base:function(){MI.confirm({title:_("确定继续发送？"),content:l,confirmTxt:_("继续发送"),confirm:function(){MI.dialog.hide();a.attips.push(g.result);a.attips=a.attips.join(",");a.send();a.attips=[];MI.Bos("btnSendAtConfirm");a.emotion&&MI.Mood.floatBox.show();a.QX&&MI.Gift&&MI.Gift.buildTalk()},cancelTxt:_("返回修改"),cancel:function(){a.emotion&&MI.Mood.floatBox.show();a.QX&&MI.Gift&&MI.Gift.buildTalk();if(UI.isArray(g.info)&&UI.isString(g.info[0])){var b=a._txt.value.indexOf(g.info[0]);if(b!=-1){b=b+g.info[0].length;MI.selectTxt(a._txt,b,b,b)}else a.focus()}MI.Bos("btnSendAtCancel")}});a.reset()}})}else if(g.result==-22){MI.confirm({type:"error",width:250,title:_("请领取天下无双勋章"),content:_("体验期间不能发表内容哦，</br>领取天下无双勋章，即可使用微博全部功能！"),confirmTxt:_("立即领取"),cancelTxt:_("取消"),confirm:function(){MI.Bos("btnSendAtAccessVerify");document.location.href=MI.api.type===5?"http://t.qq.com/qzApp/appRegister.php?step=4":"http://t.qq.com/reg/authenticationActivity.php"},cancel:function(){MI.Bos("btnSendAtCancelVerify");a._tip.innerHTML=""}});a.reset()}else if(g.result==-23){clearTimeout(a.delay.tip);a._tip.innerHTML="<span>"+_("已被禁言")+'，<a class="gotoAsk" href="###">'+_("立即申诉")+">></a></span>";if(k=e(a._tip,".gotoAsk")[0]){k.onclick=function(){MI.complainVerify({call:function(){alert(_("你的申诉已经提交，请耐心等待"));a._tip.innerHTML=""}})};k=null}}else{if(!g.info)g.info={talk:[{}]};var o=a.isAt===1?185:217,y=function(){var b=e(a._tipBig,".info")[0];if(b){UI.remove(b);a._tipBig.onmouseover=a._tipBig.onmouseout=null;UI.hide(a._tipBig);if(this!==a){a.hide();a.display=0}a.hideCall=null}};clearTimeout(a.delay.tip);a.showTip(g.msg||"",g.result<0?1:0);a.flashTip();if(g.result==0&&a._tipBig){e(a._tipBig,".msg")[0].innerHTML=g.msg;if(g.info.atrecommend){var t=g.info.atrecommend,k=UI.html(['<span class="info">和<a href="http://t.qq.com/',t.account,'" target="_blank" title="',t.username.toTitle(),"(@",t.account,')">',t.username.toTitle(),"</a>聊了一回合了，试试收听",t.gender,'？ <a class="gb_btn gb_btn8" href="http://t.qq.com/',t.account,'"><i class="icon icon_fo"></i><span class="t">收听</span></a></span>'].join(""))[0];a._tipBig.appendChild(k);MI.Card.build(a._tipBig,".info a",2);e(k,".gb_btn")[0].onclick=function(a){UI.E(a).prevent();MI.follow(t.account,this,function(){MI.feedBack({name:"timeline",id:1191,iPos:o,iBak1:3,sBak1:t.uin});MI.tip(_("收听成功"));y()})};setTimeout(function(){a._tipBig.onmouseover=function(){clearTimeout(a.delay.atTip)};a._tipBig.onmouseout=function(){clearTimeout(a.delay.atTip);a.delay.atTip=setTimeout(y,1E3)}},7E3);a.hideCall=y;MI.feedBack({name:"timeline",id:1191,iPos:o,iBak1:1,sBak1:t.uin})}a.type!=4&&UI.addClass(a._body,"pubSuc");UI.show(a._tipBig)}a.delay.tip=setTimeout(function(){UI.animate(a._tip,"opacity",1,function(){if(g.result==0){a._txt.value="";if(b.rtpic){delete MI.TalkList.rtPics[b.pId];a._resetRtPic()}}a.delay.focus=setTimeout(function(){try{a._body.style.display!="none"&&a._txt.focus()}catch(b){}},50);a.countTxt();if(a._msgTo&&g.result>-9&&g.result<-5)try{a._msgTo.select()}catch(c){}UI.C(a._tip,"opacity","");a._tip.style.filter="";a.sending=0;UI.removeClass(a._btn,"btnNoStr");if(g.result==0){a.delPic();a.delVideo();a.delMusic();a.delLongWB();a.longWB=null;a.rmsg=null;a.vote=null;a.code=null;a.pass=null;MI.Music&&MI.Music.builded&&MI.Music.clear();a._guide&&a.guideReset();a.microTpcId&&a.microTpc.clear(a)}if(a.success&&g.result==0)if(g.info.atrecommend)a.success(g,true);else{a.success(g);UI.hide(a._tipBig)}})},g.result==0?a.delayTime:a.delayTime+1E3)}a.successStart&&g.result==0&&a.successStart(g);a.failStart&&g.result!=0&&a.failStart(g);k=MI.talkList;if(a.data.wqid&&MI.talkListHot)k=MI.talkListHot;k&&(a.addList&&g.result==0&&c)&&MI.TalkBox.addNewMsg(g,!a.type,k);if(g.result==0){a.startTime=0;a.picsNum=0;if(a.autoSave&&MI.isS){k="draft_pic_"+MI.user.account;j="draft_pics_"+MI.user.account;MI.S("draft_"+MI.user.account,"");MI.S(k,"");MI.S(j,"")}MI.isS&&!a.type&&MI.app({TalkBoxRich:function(){a.cacheTopic(b.content)}});var j=d.match(/\{[^\}]{1,20}\}/g),C=[],r;if(j&&MI.user.fun.hasbrace){for(var k=0,u=j.length;k<u;++k){r=UI.trim(j[k].replace(/\n+/g," ").slice(1,-1));r!="."&&C.push(r)}setTimeout(function(){MI.syncOrder(C)},1E3)}try{MI.Group&&(MI.Group.qid&&MI.talkList&&MI.talkList.type===2&&a.type===5)&&a.countNum(1)}catch(w){}a.type!=4&&a.type!=5&&(!MI.Group||!MI.Group.qid||a.type!==7&&a.type!==2)&&a.countNum(1);var v=g.info.talk[0].timestamp,k=["talkList","talkListHot"];v&&UI.each(k,function(a){MI[a]&&MI[a].updateTime&&MI[a].updateTime(v)});a.txtCache=d;window.MIApiId&&MI.Bos({name:"btnAPITalk",sBak1:MIApiId,id:1210})}i=+new Date-h;setTimeout(function(){n=+new Date-h;MI.Speed("t_asyn_talk",0.1,m,i,n)},0)}});a.delay.timeout=setTimeout(function(){a.showTip(a.txtTip.fail,1);a._btn.disable=0;UI.removeClass(a._btn,"btnNoStr");MI.Bos("btnSendTimeout")},2E4)}};MI.TalkBox.prototype.delPic=function(){this._pic&&this.upPic&&(this.pic=this.sourcePic="",this.upPic._picForm.reset(),UI.hide(this._picPreview),UI.hide(this._picLoading),this._txt.value==this.txtPic&&(this._txt.value=""),this.txtSummary&&(this._txt.value=this._txt.value.replace(this.txtSummary,""),this.txtSummary=""),this.longTextModify=0,this.longText="",MI.Capture&&MI.Capture.uploader&&MI.Capture.uploader.StopUpload(),UI.B.chrome&&(this.upPic._picForm.innerHTML=this.upPic._picForm.innerHTML,this.upPic._picBtn=UI.GT(this.upPic._picForm,"input")[0],this.upPic._picBtn.onchange=this.upPic.picChange),this.countTxt(),UI.removeClass(this._picAnchor,"disabled"),2>UI.children(this._sendStatus,"sendThumbs").length&&UI.removeClass(this._sendCnt,"hasMedia"));this.pics=[];this.picsNum=0;this.upPic&&this.upPic.clearUrl();this.newMultiPicFun||UI.hide(e(this._box,".singlePic .cnt_2_opt")[0]);if(this.autoSave)try{MI.S("draft_pic_"+MI.user.account,""),MI.S("draft_pics_"+MI.user.account,"")}catch(a){}};MI.TalkBox.prototype.delLongWB=function(a){a||(this.longWB=null,this.longWBModify=0,UI.show(this.longWBInput),UI.hide(this.longWBSend),UI.removeClass(this.longWBDom,"d_lgwb_form2"),this._txt.value="")};MI.TalkBox.prototype.delVideo=function(){this._video&&(this.video="",UI.remove(this._videoPreview),UI.removeClass(this._videoAnchor,"disabled"),2>UI.children(this._sendStatus,"sendThumbs").length&&(!this._picPreview||this._picPreview&&"none"==this._picPreview.style.display)&&UI.removeClass(this._sendCnt,"hasMedia"),this._txt.value==this.txtVideo&&(this._txt.value=""),this.countTxt());MI.user.fun.nanoMood&&this._mood&&UI.hasClass(this._mood,"disabled")&&UI.removeClass(this._mood,"disabled")};MI.TalkBox.prototype.delMusic=function(){this.mlist=this.music="";this._music&&this.upMusic&&(UI.remove(this._musicPreview),UI.hide(this.upMusic._musicBox),UI.removeClass(this._musicAnchor,"disabled"),this._recordAnchor&&UI.removeClass(this._recordAnchor,"disabled"),this._txt.value.hasString(this.txtMusic)&&(this._txt.value=this._txt.value.replace(this.txtMusic,"")),this.countTxt());MI.user.fun.nanoMood&&this._mood&&UI.hasClass(this._mood,"disabled")&&UI.removeClass(this._mood,"disabled")};MI.TalkBox.prototype.cancelPic=function(){this._pic&&this.upPic&&(this.pic="",UI.hide(this._picLoading),this.upPic._iframe.src="about:blank",this.upPic._picForm.reset(),UI.removeClass(this._picAnchor,"disabled"),this.upPic._picCapture[1]&&UI.removeClass(this.upPic._picCapture[1],"loading"),2>UI.children(this._sendStatus,"sendThumbs").length&&UI.removeClass(this._sendCnt,"hasMedia"))};MI.TalkBox.prototype.pics=[];MI.TalkBox.prototype._addPic=function(a){var b=this,c,d,h,m,i,n,j,f,l,k;b.longTextModify=a.info&&a.info.longTextModify;if(b.upPic){j=b.upPic.PicUpTime;f=+new Date;UI.hide(b._picLoading);b.upPic._box.style.left="";if(0==a.result){if(1==b.upPic.flashCapture){MI.PhotoMultiUpload.captureImg(a.info.image+"/2000");UI.hide(MI.PhotoMultiUpload.loading);return}if(2==b.upPic.flashCapture){document[b.ShuoShuoUploader].addImagesByUrl([{url:a.info.image+"/2000",name:_("截屏图片")}]);UI.hide(MI.PhotoMultiUpload.loading);return}a.isShow||b.hideMedia();UI.hasClass(b._sendCnt,"hasMedia")||UI.addClass(b._sendCnt,"hasMedia");a.info.image=a.info.image.replace(/\/\d{1,4}$/g,"");n=a.info.host;c=a.info.image;if(9<=b.picsNum){MI.alert(_("已达到{0}张上限，无法继续添加",9));return}b.pics.push(c);b.picsNum=b.pics.length;1<b.picsNum&&(d=1);d&&(a.info.fileName=_("{0}张图片",b.picsNum));(h=c.hasString("qpic.cn"))?(b.pic=c,m=c+"/160",i=c+"/2000"):m=i=b.sourcePic=c;MI.PicTurn&&(MI.PicTurn.url="http://"+(n?n:"upload.t.qq.com"));MI.user.fun.turnPic&&a.info.path&&MI.PicTurn.reset(b.pic,a.info.path);var g=MI.user.fun.turnPic&&a.info.path;n=a.info.fileName||b.upPic._picBtn.value;var p=n.substring(n.lastIndexOf(".")+1,n.length);n=n.match(/[^\/|\\]*$/)[0].replace(RegExp(p+"$"),"");n=MI.string.cut(n,10)+p;if(g||"none"==b._pic.style.display||""==UI.text(b._pic))b._picLink.innerHTML='<em class="sico ico_pic"></em><a href="'+i+'" class="fileName" target="_blank">'+n+"</a>";else if(UI.append(b._uploadPicS,b._sendStatus),i=null,i=d?(new UI.tmplString('<div class="upPics_view_imgs upPics_view_num_<%=pics.length%> clear"><%UI.each(pics, function(o){%><span class="simg_item"><img src="<%=o%>/160"></span><%});%></div>'))({pics:b.pics}):(new UI.tmplString('<table class="upPics_view_table"><tbody><tr><td class="pic"><img src="<%=picSmall%>"<%=width%>></td>'+(b.longTextModify?"":'<td class="opt"><a href="#" class="gb_btn gb_btn5 mh_lk"><span class="t">美化图片</span></a><%if(MI.user.fun.newPicUpload){%><a href="#" class="gb_btn gb_btn5 mh_lk"><span class="t">继续上传</span></a><%}%></td>')+"</tr></tbody></table>"+(b.longTextModify?'<p class="upPics_view_ft"><a href="#">返回修改</a></p>':"")))({picSmall:m,width:h?"":'width="160"'}),h=[d?'<i class="ico_pics"></i>':'<em class="sico ico_pic"></em>','<a href="javascript:void(0);" class="fileName" style="position:relative;">',n,'</a><div class="upPics_view" style="">',i,"</div>"].join(""),b._picLink.innerHTML=h,!d)if(d=e(b._picLink,".mh_lk"),h=e(b._picLink,".upPics_view_ft")[0],d[0]&&(d[0].onclick=function(){x();if(b.newMultiPicFun){if(b.newPicObj)b.newPicObj.PicFilter=1;UI.fireEvent(e(b._body,".uploadPic .txt")[0],"click");UI.show(e(b._box,".singlePic .cnt_2_opt")[0])}else{MI.app({Base:function(){MI.photoFilter.build(a.info.path?MI.PicTurn.url+a.info.path:c+"/2000","http://api.t.qq.com/asyn/updateGrabPic.php");MI.TalkBox.cur=b}});MI.Bos("btnPhotoFilter");MI.Bos2Open("170278","2.0","101")}return false}),d[1]&&(d[1].onclick=function(){UI.removeClass(b._picAnchor,"disabled");x();UI.fireEvent(e(b._body,".uploadPic .txt")[0],"click");UI.show(e(b._box,".singlePic .cnt_2_opt")[0]);return false}),h)h.onclick=function(){UI.removeClass(b._picAnchor,"disabled");b.delPic();b.longTextModify=1;if(b.longTextSource==1){UI.fireEvent(e(b._body,".uploadPic .txt")[0],"click");b.upPic.switchTab(2)}b.longTextSource==2&&UI.fireEvent(e(b._body,".btnTextToPic")[0],"click");return false};e(b._picLink,".fileName");var q;d=function(){if(UI.A(b._picLink,"moAble")!="0")if(g)MI.PicTurn.show();else{clearTimeout(q);clearTimeout(MI.PicTurn.autoHideDelay);UI.show(e(b._picLink,".upPics_view")[0])}};var x=function(){g?MI.PicTurn.hideT():q=setTimeout(function(){UI.hide(e(b._picLink,".upPics_view")[0])},200)};UI.EA(b._picLink,"mouseover",d);UI.EA(b._picLink,"mouseout",x);UI.width(b._pic)&&d();MI.PicTurn.autoHideDelay=setTimeout(x,3E3);a.isShow&&UI.hide(e(b._picLink,".upPics_view")[0]);UI.show(b._picPreview);b.guideTextRemove();""==b._txt.value&&n!=_("表情.jpg")&&(b._txt.value=b.txtPic,b.countTxt());b.focus()}else b.cancelPic(),MI.alert(a.msg);b.upPic._picForm.reset();j&&(l=+new Date-j,setTimeout(function(){k=+new Date-j;MI.Speed("t_asyn_uploadpic",1,f,l,k)},0));b.upPic.PicUpTime=null;if(b.autoSave&&a)try{a.info.fileName=n,delete a.isShow,MI.S("draft_pic_"+MI.user.account,UI.json2str(a)),MI.S("draft_pics_"+MI.user.account,UI.json2str(b.pics.slice(0,-1)))}catch(s){}}else setTimeout(function(){b._pic&&(UI.fireEvent(b._pic,"click"),a.isShow||b.hideMedia());b.addPic(a)},100)};MI.TalkBox.prototype._getVideo=function(a){var b=this,c=b.upVideo;b.ayncVideoResult=null;UI.trim(a)&&(this.delayVideo&&clearTimeout(this.delayVideo),MI.user.fun.nanoMood&&b._mood&&!UI.hasClass(b._mood,"disabled")&&UI.addClass(b._mood,"disabled"),this.delayVideo=window.setTimeout(function(){c&&(c._videoError.innerHTML=c._errMsg[1],UI.show(c._videoError));MI.ajax({url:MI.url.validateVideo,type:"get",data:"url="+encodeURIComponent(a),success:function(a){if(c)c._videoBtn.disabled=false;a=MI.json(a);b.ayncVideoResult=a.result;if(a.result==0){c&&UI.hide(c._videoError);if(a.url){clearTimeout(b.delayVideoTime);var h=a.title.replace(/\&amp;/g,"&").replace(/\&lt;/g,"<").replace(/\&gt;/g,">").replace(/\&quot;/g,'"'),m=_("#分享视频#")+h+" http://url.cn/"+a.url+" ",i='<div class="sendThumbs uploadVideo"><span class="preview"><span class="link"><em class="sico ico_videos"></em><a class="fileName" href="#">%title%<span class="vThumbs"><span class="mask"><em></em></span><img src="%pic%" onload="MI.TalkList.resizePic(this)" /></span></a></span><a class="del" href="#" title="'+_("删除")+'">['+_("删除")+"]</a></span></div>";a.pic=a.pic?a.pic:"http://mat1.gtimg.com/www/mb/images/vNoThumbs.jpg";h=i.replace(/\%title\%/g,MI.string.cut(MI.string.html(h),10)).replace(/\%pic\%/g,a.pic);b._videoPreview=UI.html(h)[0];UI.append(b._videoPreview,b._sendStatus);UI.addClass(this,"disabled");!UI.hasClass(b._sendCnt,"hasMedia")&&UI.addClass(b._sendCnt,"hasMedia");b.video=a.url;b.txtVideo=m;if(c){b.addTopic(m);c._videoTxt.value=""}b.countTxt();b.focus();a=e(b._videoPreview,".del")[0];a.onclick=function(a){UI.E(a).stop();b.delVideo();return false};a=null;UI.addClass(b._videoAnchor,"disabled");c&&c.hide()}}else{if(a.result==-1){if(c){c._videoError.innerHTML=c._errMsg[0];UI.show(c._videoError)}}else if(a.result==-3){if(c){c._videoError.innerHTML=c._errMsg[3];UI.show(c._videoError);b._videoNormalBtn=e(c._box,".vNormalBtn")[0];b._videoNormalBtn.onclick=function(){if(UI.trim(c._videoTxt.value)){b._txt.value=b._txt.value+UI.trim(c._videoTxt.value);c._videoTxt.value="";clearTimeout(b.delayVideoTime);c.hide()}return false}}}else if(c){c._videoError.innerHTML=c._errMsg[2];UI.show(c._videoError)}MI.user.fun.nanoMood&&(b._mood&&UI.hasClass(b._mood,"disabled"))&&UI.removeClass(b._mood,"disabled")}}});c&&(b.delayVideoTime=setTimeout(function(){if(!b.ayncVideoResult&&c){c._videoError.innerHTML=c._errMsg[2];UI.show(c._videoError)}},2E4))},200))};MI.TalkBox.prototype.uploadCollection=function(a){var b=this,c=a.name,d=a.tab,h=a.cnt,m=a.query,i=a.className,n=a.flashTab||[],j=a.buildEvent,f=a.tabEvent,l=a.showEvent,k=a.hideEvent,a=a._open,g=b["up"+c]={},p=['<div class="D3 '+i+'" style="',"insertVote"==i&&UI.B.ipad?"width:530px; ":"",'display:none"><div class="tabStyle3"><ul>'].join("");UI.each(d,function(a){p+='<li><a href="#">'+a+"</a></li>"});p+='</ul><a class="close" href="#" title="'+_("关闭")+'"></a></div>';p+=h;p+='<div class="SA"><em>◆</em><span>◆</span></div></div>';g._box=UI.html(p)[0];g._open=a;g._tab=e(g._box,".tabStyle3 li");g._div=e(g._box,m);g._close=e(g._box,".tabStyle3 .close")[0];g._arrows=e(g._box,".SA")[0];UI.after(g._box,b._sendStatus);(UI.B.ipad||""==UI.text(b._pic)||MI.user.fun.qbUpload||b.noFlash)&&UI.each(n,function(a){UI.hide(g._tab[a])});if(b.showPicTabs.length){UI.each(g._tab,function(a){UI.hide(a)});1==b.showPicTabs.length&&"all"==b.showPicTabs[0]&&(b.showPicTabs="multi merge link text camera soso".split(" "));UI.each(b.showPicTabs,function(a){UI.show(g._tab[b.picTabsConfig[a]])});for(d=d=0;d<b.showPicTabs.length&&!(b.picTabsConfig[b.showPicTabs[d]]||0==b.picTabsConfig[b.showPicTabs[d]]);d++);d==b.showPicTabs.length&&UI.each(g._tab,function(a){UI.show(a)})}g.switchTab=function(a){UI.hasClass(this,"select")||(UI.each(g._div,function(b,c){a==c?(UI.addClass(g._tab[c],"select"),UI.removeClass(g._div[c],"hideDcnt")):(UI.removeClass(g._tab[c],"select"),UI.addClass(g._div[c],"hideDcnt"))}),f&&MI.app({Base:function(){f(g,a)}}))};UI.each(g._tab,function(a,b){a.onclick=function(){g.switchTab(b);return!1}});g.hide=function(){"none"!=g._box.style.display&&(k&&k(g),UI.hide(g._box),b._picLink&&UI.A(b._picLink,"moAble","1"))};g.setArrPos=function(a){if(a){a==b._vote&&(a=b._moreBox);var c=g.arrPos||UI.getX(a)+UI.width(a)/2-UI.getX(g._box.parentNode);UI.text(a)||(c-=7);g._arrows.style.left=c+"px";return c}};g.show=function(a){var d=[];0==b.pics.length&&!b.pic&&!b.sourcePic?d=null:1<b.pics.length?UI.each(b.pics,function(a){d.push(a)}):d=[b.pic?b.pic:b.sourcePic];window._jsflash_singlePic=function(){return d};for(var h=0,e=0;e<g._tab.length;e++)if("none"!=g._tab[e].style.display){h=e;break}MI.TalkBox.cur=b;if("none"!=g._box.style.display)return!1;b.hideMedia();if(UI.hasClass(g._open,"disabled"))return!1;UI.show(g._box);l&&l(g);g.switchTab(a||h);g._open.blur();MI.Bos("btn"+c);g.setArrPos(g._open);g.showed=1;return!1};g._close.onclick=function(){document[b.ShuoShuoUploader]&&document[b.ShuoShuoUploader].clearAll&&document[b.ShuoShuoUploader].clearAll();b.longTextSource==b.curLongTextSource?b.longTextModify=0:b.longTextSource=b.curLongTextSource||0;b.newPicObj&&(b.newPicObj.PicFilter=0);g.clearUrl();UI.hasClass(g._box,"insertVote")?(MI.Bos("btnCloseVote"),b.voteModify?MI.Text2Pic.confirmCancel("upVote"):(b.resetVote2(b.upVote),g.hide())):g.hide();return!1};g._open.onclick=function(){return!1};g.clearUrl=function(){};j&&j(g)};MI.TalkBox.prototype.newMultiPicFun=MI.user.fun.newMultiPicFun;MI.TalkBox.prototype.events={".top .close":function(a,b){var c=this;UI.A(c,"hasCall")||(UI.B.ie&&UI.C(c,"right","9999px"),setTimeout(function(){b.hide();UI.C(c,"right","")},0),MI.Bos("btnClose"))},".creatNew":function(a,b){b.guideTextRemove(1);MI.Bos("btnTopic");var c=MI.getSelectTxt(b._txt);if(b._txt.value&&c.txt&&c.txt!=b.txtTopic.replace(/#/g,""))return MI.selectTxt(b._txt,c.start,c.start),MI.insertTxt(b._txt,"#",c.start),MI.selectTxt(b._txt,c.end+1,c.end+1),MI.insertTxt(b._txt,"#",c.end+1),MI.selectTxt(b._txt,c.start+1,c.end+1),b.countTxt(),!1;b.addTopic()},".btnASFeedback":function(a,b){var c=b._txt;c.value.hasString("#微博无障碍意见反馈#")||(c.value="#微博无障碍意见反馈#"+c.value);MI.focus(c);MI.Bos({name:"btnASFeedback",id:1210})},".atSome":function(a,b){var c=this;b.hideMedia();setTimeout(function(){b.autoCmt&&b.autoCmt.showAll(c)},0);MI.TalkBox.cur=b;MI.Bos("btnAt",0,0.01)},".btnTextToPic":function(a,b){b.curLongTextSource=b.longTextSource;b.iframe||(b.iframe=UI.html('<div class="DshareWrap dialogTalkBox" id="longTextFloat" style=""> <div class="tabStyle1 shareTitle"><ul></ul></div><div class="explain" style="display: none;"><div style="padding: 10px 0px;"></div></div><iframe src='+MI.Text2Pic.url+' frameborder="0" width="460" height="440" scrolling="no" style=""></iframe></div>')[0]);9==b.picsNum?MI.alert("最多只能同时传9张图片！"):(b.hideMedia(),MI.TalkBox.cur=b,b.text2Pic||(b.text2Pic=new MI.Dialog),b.longTextModify&&2==b.longTextSource)?(b.delPic(),b.text2Pic.show()):b.text2Pic.show({title:'<h3 class="DmainTit">'+_("长微博")+"</h3>",width:460,html:b.iframe,start:function(){e(f("longTextFloat"),"iframe")[0].src=MI.Text2Pic.url;b.longTextSource=2},closeEnd:function(){b.longTextSource==b.curLongTextSource?b.longTextModify=0:b.longTextSource=b.curLongTextSource||0}});MI.Bos("btnTextToPic");MI.Bos2Open("170542","2.0","101")},".btnMicoZt":function(a,b){b.microTpc()},".btnMicoZj":function(){MI.app({SubjectPublish:function(){MI.SubjectPublish.create(function(a){location.href="http://p.t.qq.com/subject/subject.php?sid="+a})}})},".btnRealWord":function(){MI.app({"t/mi.RealWord":function(){MI.RealWord.createRealWord(1)}});MI.Bos("btnRealWord")},".insertFace .txt,.ico_face":function(a,b){b._face=this;if(MI.user.fun.nanoMood&&UI.hasClass(this,"disabled"))return!1;b.hideMedia();MI.app({TalkBoxRich:function(){b.addFace()}});MI.Bos("btnFace",(b.type||1)+"")},".atWen .txt":function(a,b){var c="",d=UI.A(this,"user"),h="#"+(UI.A(this,"topic")||_("微博拜年"))+"#",e=b._txt.value;e.hasString(h)||(c+=h);"@"!=e.slice(MI.cursorX(b._txt)-1)&&!d&&(c+="@");d&&!e.hasString(d)&&(c+="@"+d+" ");c?b.addTopic(c):MI.focus(b._txt);b._moreBox&&UI.removeClass(b._moreBox,"sopen");MI.Bos("btnTopicNewYear")},".newFeel .txt":function(a,b){b._mood=this;MI.user.fun.nanoMood||(MI.user.fun.feelTip&&(b._moodIco&&""!=b._moodIco.innerHTML)&&(UI.A(b._mood,"title",_("心情")),b._moodIco.innerHTML="",MI.Bos("btnMoodClickFlick")),MI.app({Mood:function(){MI.Mood.floatBox.show()}}),MI.Bos(UI.A(this,"sign")?"btnMoodTalkBoxLook":"btnMoodTalkBoxWrite"))},".newVote .txt":function(a,b){MI.TalkBox.cur=b;b._vote=this;b.addNewVote();b._moreBox&&UI.removeClass(b._moreBox,"sopen");MI.Bos("btnVote")},".newOrder .txt":function(a,b){if(!b.upOrder){var c='<div class="orderBox"><p>'+_("粘贴商品地址")+'</p><p class="clear"><input type="text" class="inputTxt"><button class="btn1">'+_("确定")+'</button></p><p class="cError" style="display:none"></p></div>';b.uploadCollection({type:null,name:"Order",tab:[_("商品")],cnt:c,query:".orderBox",className:"insertOrder",flashTab:[],_open:this,buildEvent:function(a){var c=RegExp("((news|telnet|nttp|file|http|ftp|https)://){1}(([-A-Za-z0-9]+(\\.[-A-Za-z0-9]+)*(\\.[-A-Za-z]{2,5}))|([0-9]{1,3}(\\.[0-9]{1,3}){3}))(:[0-9]*)?(/[-A-Za-z0-9_\\$\\.\\+\\!\\*\\(\\),;:@&=\\?/~\\#\\%]*)*","i"),m=[_("你输入的商品链接已提交，请等待"),_("商品地址不能为空，请在输入框粘贴或输入"),_("不支持该地址，请重新输入")];a._inputTxt=e(a._box,".inputTxt")[0];a._submit=e(a._box,".btn1")[0];a._tip=e(a._box,".cError")[0];a._submit.onclick=function(){var e=UI.trim(a._inputTxt.value);c.test(e)?(a._submit.disabled=!0,a._tip.innerHTML=m[0],UI.show(a._tip),MI.ajax({url:MI.url.uploadOrder,type:"post",data:{op:1,url:UI.utfEncode(e)},success:function(c){c=MI.json(c);if(0==c.result&&c.info){var h=(c.info.topic||"")+(c.info.name||"");b._txt.value.hasString(h)||b.addTopic(h);a._tip.innerHTML=m[0];a.hide();b.rmsg={type:0,id:c.info.id}}else a._submit.disabled=!1,a._tip.innerHTML=c.msg}})):(a._inputTxt.focus(),a._tip.innerHTML=!e?m[1]:m[2],UI.show(a._tip))}},showEvent:function(a){a._inputTxt.value="";a._submit.disabled=!1;a._tip.innerHTML="";a._inputTxt.focus()}})}b.upOrder.show(0);b._moreBox&&UI.removeClass(b._moreBox,"sopen")},".newGift .txt":function(){var a=UI.A(this,"eventId");MI.sendGiftShow(1*a);MI.Bos("btnTalkBoxSendGift"+a)},".uploadFile .txt":function(){window.open("http://file.t.qq.com/uploadfile.php?qid="+(MI.Group&&MI.Group.qid?MI.Group.qid:0),"wbUploadFile","height=320,width=594,top="+(window.screen.availHeight-30-320)/2+",left="+(window.screen.availWidth-10-594)/2+",scrollbars=yes,resizable=yes");MI.Bos("btnUploadFile")},".uploadVideo .txt":function(a,b){b._videoAnchor=this;if(!b.upVideo){b._video=this;var c='<div class="videoWrap uploadVideo">\t<a class="btn_addPic" href="javascript:void(0);"><span><em>+</em>从电脑上传视频</span></a></div><div class="videoWrap urlVideo"><form method="get" class="videoUploadFrom" id="videoUploadFrom" name="videoUploadFrom"><p>'+_("粘贴视频播放页地址")+'<span class="cNote">('+_("支持腾讯视频、优酷、土豆、酷六、CNTV")+')</span></p><div class="m_searchBox clear">\t<span class="m_item1"><input type="text" class="inputTxt"></span><span class="m_item2"><label class="gb_btn gb_btn1"><input type="button" value="'+_("确定")+'" class="t"></label></span></div><p class="cError" style="display: none; "><a href="#" class="vNormalBtn"></a></p>\t</form></div>  \t<div class="videoWrap hideDcnt cameraVideo"><div class="flashWrap"></div><div class="maskLoading"></div>\t</div>';b.videoUploadBuild=function(){b.uploadCollection({type:1,name:"Video",tab:!MI.user.fun.selfVideo?[_("上传视频"),_("在线视频")]:[_("上传视频"),_("在线视频"),_("拍摄视频")],cnt:c,query:".videoWrap",className:"insertVideo",flashTab:[0,2],_open:b._video,buildEvent:function(a){a._videoForm=e(a._box,".videoUploadFrom")[0];a._videoTxt=e(a._box,".inputTxt")[0];a._videoBtn=e(a._box,".gb_btn1")[0];a._videoError=e(a._box,".cError")[0];a._videoUpload=e(a._box,".btn_addPic")[0];a._errMsg=[_("请先登录再进行操作"),_("稍等一下，喝杯茶，转贴的视频正在来的路上"),_("转贴的视频丢在路上了，再试一次？"),_("暂不支持该视频地址，")+'<a href="#" class="vNormalBtn">'+_("作为普通链接显示")+"</a>"];a._videoForm.onsubmit=function(){if(!UI.trim(a._videoTxt.value))return a._videoTxt.focus(),!1;b.getVideo(UI.trim(a._videoTxt.value));a._videoBtn.disabled=!0;return!1};a._videoBtn.onclick=function(){if(UI.trim(a._videoTxt.value))return b.getVideo(UI.trim(a._videoTxt.value)),this.disabled=!0,!1;a._videoTxt.focus()};a._videoUpload.onclick=function(){a.hide();var c="http://p.t.qq.com/uploadvideo.php",e=(window.screen.availHeight-30-259)/2,i=(window.screen.availWidth-10-594)/2;b.data&&b.data.wqid&&(c=c+"?qid="+b.data.wqid+"&zone="+b.data.cflag);window.open(c,"wbVideo","height=259,width=594,top="+e+",left="+i+",scrollbars=yes,resizable=yes");MI.Bos("btnVideoUpload");return!1}},showEvent:function(a){UI.hide(a._videoError)},tabEvent:function(a,c){if(2==c){var e=a._div[c],i=["","","VideoRecord"][c],n=["","","btnVideoRecord"][c];MI.app({TalkBoxRich:function(){MI[i].build(e,"#");MI.TalkBox.cur=b}});MI.Bos(n)}else 1==c&&(UI.trim(a._videoTxt.value)?a._videoTxt.select():a._videoTxt.focus())},hideEvent:function(){clearTimeout(b.delayVideoTime);MI.app({TalkBoxRich:function(){MI.VideoRecord&&MI.VideoRecord.clear()}})}})};b.videoUploadBuild()}b.upVideo.show(0)},".uploadMusic .txt":function(a,b){b.upMusic||(b._music=this.parentNode,b._musicAnchor=this,b.musicUploadBuild=function(){if(!b.upMusic){var a=!MI.user.fun.newMusicBox?[_("上传音乐"),_("音乐收藏")]:[_("分享歌曲"),_("分享歌单")];"en_US"!=window.MILang&&MI.user.fun.audioRecord&&a.push(b.recordTabName||_("我要录音"));MI.user.fun.audioUpload&&a.push(_("本地上传"));b.uploadCollection({type:2,name:"Music",tab:a,cnt:'<div class="m_sResult rSearch"><div class="m_self"></div></div>  <div class="m_sResult rFav hideDcnt"></div>  <div class="m_sResult recordBox hideDcnt"></div>  <div class="m_sResult recordUploadMusic">\t<a class="btn_addPic btnUploadMusic" href="javascript:void(0);"><span><em>+</em>从电脑上传音乐</span></a>  </div>',query:".m_sResult",className:"insertMusic",flashTab:"en_US"==window.MILang?[]:[2],_open:b._musicAnchor,buildEvent:function(a){if(!e(b._sendStatus,".btnUploadMusic")[0])if(MI.Music){if(!MI.Music.builded||!b.MusicBuild)MI.Music.build(b),b.MusicBuild=1;MI.Music.show()}else MI.app({Music:function(){MI.Music&&(MI.Music.build(b),MI.Music.show())}});MI.app({Music:function(){a._audioUpload=e(a._box,".btnUploadMusic")[0];if(!MI.user.fun.audioUpload)return UI.hide(a._audioUpload),UI.hide(a._tab[MI.user.fun.audioRecord?3:2]),!1;a._audioUpload&&(a._audioUpload.onclick=function(){a.hide();b.audioUpload();return!1})}})},showEvent:function(){MI.Music&&MI.Music.talkBoxList&&UI.each(MI.Music.talkBoxList,function(a){a==b?MI.Music.talkBox=b:a.upMusic.hide()})},hideEvent:function(a){clearTimeout(b.delayMusicTime);a._div[2].innerHTML="";MI.Music&&MI.Music.stop()},tabEvent:function(a,b){2==b&&(MI.Flash&&9>MI.Flash.getVersion()?a._div[2].innerHTML=MI.Flash.updateTip(9):""==a._div[2].innerHTML&&(a._div[2].innerHTML=MI.user.fun.audioRecord?'<div class="flashWrap">'+MI.Flash.getObject(null,MI.swf.MusicRecord,404,160,"musicRecord")+"</div>":""))}})}},window.getMicRecUploadResult=function(a,d,h){0==a&&(UI.A(b.upMusic._tab[2],"music","0,"+d+","+MI.user.account+","+_("录音")),MI.Music.addPreview(b.upMusic._tab[2],"",1),b.upMusic.hide(),b.music.songtype=3,b.music.shorturl=h,b.txtMusic=_("来，听听我的声音。")+" http://url.cn/"+h+" ",b._txt.value=b._txt.value!=b.txtMusic?b._txt.value+b.txtMusic:b.txtMusic,b.countTxt(),b.focus())},window.getRecDuration=function(){var a=[180,120,170,15];2==MI.TalkBox.prototype.data.cflag&&(a=[180,120,170,17]);return a},b.musicUploadBuild());b.upMusic.show(0);b.upMusic.setArrPos(b._musicAnchor);UI.show(b.upMusic._tab[0]);UI.show(b.upMusic._tab[1]);b.upMusic.switchTab(0)},".record .txt":function(a,b){UI.B.ipad||MI.user.fun.qbUpload?UI.hide(this.parentNode):(b._recordAnchor=this,b._musicAnchor||(b._musicAnchor=e(b._body,".uploadMusic .txt")[0]),UI.fireEvent(b._musicAnchor,"click"),b.upMusic.setArrPos(b._recordAnchor),UI.hide(b.upMusic._tab[0]),UI.hide(b.upMusic._tab[1]),UI.hide(b.upMusic._tab[3]),b.upMusic.switchTab(2))},".uploadPicConfirm":function(a,b){b.newPicObj&&!b.newPicObj.PicFilter?(document[b.ShuoShuoUploader].upload(MI.url.uploadGrabPic+"?call=2&uin="+MI.user.uin,{}),b.normalPicClick=1,MI.Bos("btnMultiPicUpload")):(document[b.ShuoShuoUploader].endFilter(),b.newPicObj.endFilter())},".uploadPicCancel":function(a,b){b.newPicObj&&!b.newPicObj.PicFilter?(b.hideMedia(),b.upPic.clearUrl()):(document[b.ShuoShuoUploader].cancelBeautify(),b.newPicObj.cancelFilter())},".uploadPic .txt":function(a,b){b._picAnchor=this;b._pic=UI.parent(this);b.curLongTextSource=b.longTextSource;if(!MI.user.fun.nanoMood&&!(b.upPic&&"none"!=b.upPic._box.style.display)){b.addEvented||b.addEvent();if(!b.upPic){b.ShuoShuoUploader="ShuoShuoUploader"+MI.random();if(10.3>MI.Flash.getVersion()||UI.B.ipad)MI.user.fun.newSinglePicUpload=0,MI.user.fun.newPicUpload=0;UI.B.os6&&(MI.user.fun.qbUpload=0);UI.each(b.showPicTabs,function(a){if(a=="normal"){MI.user.fun.newPicUpload=0;MI.user.fun.newSinglePicUpload=0}});var c="imageUpload_"+MI.random(),d="http://upload.t.qq.com"+MI.url.uploadPic,h=MI.user.fun.qbUpload?' type="button" value="&nbsp;" ':' type="file" size="3"',m;m="2013-01-01 00:00:00";var i=void 0,n="",j=MI.time+"000",i=i?UI.parseDate(i,"yyyy-MM-dd hh:mm:ss").getTime():j;m=UI.parseDate(m,"yyyy-MM-dd hh:mm:ss").getTime();j>=i&&j<=m&&(n='<span style="color:#333;">&nbsp;&nbsp;秀出你的老照片，和今天做个对比，送积分赢Q币！<a boss="btnOldNewAct" href="http://event.t.qq.com/69181?pgv_ref=web.event.oldtime.upload.text" target="_blank">查看详情>></a></span>');m=n;var i=['<div class="sendThumbs uploadPicS"><span style="display:none" class="pidLoad loading">',_("上传中"),'<a class="cancel" href="#">[',_("取消"),']</a></span><span style="display:none;" class="preview"><span class="link"><em class="sico ico_pic"></em></span><a href="#" class="del" title="',_("删除"),'">[',_("删除"),']</a></span><iframe id="',c,'" name="',c,'" src="about:blank" style="display:none"></iframe></div>'].join(""),o=['<div class="picDiv singlePic"><p class="info">',MI.user.fun.newPicUpload?_("{0}最多上传9张图片"+m+"{1}","<span>","</span>"):"",'</p><div class="cnt_2"',MI.user.fun.newPicUpload?"":' style="display:none"','>\t<div class="cnt_2_swf"></div>\t<div class="cnt_2_opt clear" style="display:none">',b.newMultiPicFun?'<div class="left"><a href="http://app.t.qq.com/app/intro/170278?via=170278_WB.TQQ.ADDTWEET" boss="btnPicCamera360" class="camera360 c_tx5" target="_blank"><i class="ico_camera360"></i><span>Powered by Camera360 [相机360]</span></a></div>':"",b.newMultiPicFun?'<div class="right">':"",'<label class="gb_btn gb_btn1"><input type="button" value="',_("上传"),'" class="t uploadPicConfirm"></label><label class="gb_btn gb_btn5"><input type="button" value="',_("取消"),'" class="t uploadPicCancel"></label>',b.newMultiPicFun?"</div>":"",'</div></div><div class="cnt_1"',MI.user.fun.newPicUpload?' style="position:absolute;left:-999px"':"",'>\t<form target="imageUpload" method="post" enctype="multipart/form-data" class="sPicForm"><a class="btn_addPic" href="javascript:void(0);"><span><em>+</em>',_("添加图片"),'</span><input class="filePrew" name="pic"',h,'title="',UI.B.ie?"双击":"",_("添加图片,支持jpg、jpeg、gif、png格式，文件小于5M"),'" tabindex="3"/></a></form>\t<p><a class="ulink capture" style="display:none;" href="#">',_("直接截屏上传"),'</a></p></div>\t</div>\t<div class="picDiv hideDcnt multiPic"><p>',_("{0}将多张图片拼接成1张（最多9张，按住Ctrl键选中，拖动图片可调整顺序）{1}","<span>","</span>"),'</p><div class="flashWrap"></div><div class="clear"><p class="left" style="padding:5px 0 0 0"><a href="http://app.t.qq.com/app/intro/170278?via=170278_WB.TQQ.ADDTWEET" boss="btnPicCamera360" class="camera360 c_tx5" target="_blank"><i class="ico_camera360"></i><span>Powered by Camera360 [',_("相机"),'360]</span></a><a class="ulink capture" style="display:none;" href="#">',_("直接截屏上传"),'</a></p><p class="right"><span class="error"></span><label class="gb_btn gb_btn1"><button type="button" class="t btnSend">',_("上传"),'</button></label><label class="gb_btn gb_btn5"><button type="button" class="t btnCancel">',_("取消"),'</button></label></p></div><div class="maskLoading"></div></div>\t<div class="picDiv hideDcnt Text2Pic" style="display:block;">                <iframe src='+MI.Text2Pic.url+' width="460" scrolling="no" height="430" frameborder="0" onload="MI.dialog.hideLoad()"></iframe>            </div>\t<div class="picDiv hideDcnt urlPic"><p>',_("粘贴图片地址"),'<span class="cNote">(',_("可在广播中直接显示图片"),')</span></p><form method="get" class="sourcepicFrom" name="sourcepicFrom"><p class="clear"><div class="m_searchBox clear"><span class="m_item1"><input type="text" class="inputTxt"></span><span class="m_item2"><label class="gb_btn gb_btn1"><input type="button" class="t urlPicBtn" value=',_("上传"),'></label></span></div></p><p class="cError" style="display:none">',_("图片地址不能为空，请在输入框粘贴或输入"),'</p></form>\t</div>\t<div class="picDiv hideDcnt cameraPic"><div class="flashWrap"></div><div class="clear" style="display:none"><p class="left"><span class="tip"></span></p><p class="right"><label class="gb_btn gb_btn1"><button type="button" class="t btnSend">',_("上传"),'</button></label><label class="gb_btn gb_btn5"><button type="button" class="t btnCancel">',_("取消"),'</button></label></p></div><div class="maskLoading"></div>\t</div>\t<div class="picDiv hideDcnt searchPic" style="height:208px"><div class="p_sResult"></div></div>'].join("");b._uploadPicS=UI.html(i)[0];b._picLoading=e(b._uploadPicS,".pidLoad")[0];b._picPreview=e(b._uploadPicS,".preview")[0];b._picLink=e(b._uploadPicS,".link")[0];UI.append(b._uploadPicS,b._sendStatus);MI.user.fun.turnPic&&(UI.append(MI.PicTurn.build(b),b._uploadPicS),d=MI.PicTurn.url+d);b.picUploadBuild=function(){var a=[_("本地上传"),_("多图"),_(MI.user.fun.hasLongtxtBlog?"长文转图":"长微博"),_("链接"),_("拍照"),_("搜图")];window.MILang=="en_US"&&(a=[_("本地上传"),_("多图"),_(MI.user.fun.hasLongtxtBlog?"长文转图":"长微博"),_("链接"),_("拍照")]);MI.user.fun.newSinglePicUpload&&!MI.user.fun.newPicUpload&&(a[1]=a[0]);if(MI.user.fun.newPicUpload){a[0]=_("普通模式");a[1]=_("拼图模式")}b.uploadCollection({type:0,name:"Pic",tab:a,cnt:o,query:".picDiv",className:"insertPic",flashTab:[1,3,4],_open:b._picAnchor,buildEvent:function(a){a._picForm=e(a._box,".sPicForm")[0];a._iframe=f(c);a._picBtn=UI.GT(a._picForm,"input")[0];a._picDel=e(b._uploadPicS,".del")[0];a._picCancel=e(b._uploadPicS,".cancel")[0];a._picCapture=e(a._box,".capture");a._sourcepicBox=a._div[3];a._sourcepicTxt=e(a._sourcepicBox,".inputTxt")[0];a._sourcepicBtn=e(a._sourcepicBox,".urlPicBtn")[0];a._sourceError=e(a._sourcepicBox,".cError")[0];a._sourcepicFrom=e(a._sourcepicBox,".sourcepicFrom")[0];a._searchPicBox=a._div[5];b._searchPicBox=a._searchPicBox;b.newPicObj=b.newPic();(UI.B.ipad||MI.user.fun.qbUpload)&&UI.hide(a._picCapture[0]);MI.user.fun.newPicUpload&&b.newAddPic().bind();!MI.user.fun.qbUpload&&(!UI.B.ipad&&!UI.hasClass(document.body,"ipad")&&!b.pic&&(!b._picLoading||UI.C(b._picLoading,"display")=="none")&&MI.TalkBox.captureEnable())&&UI.each(a._picCapture,function(c,d){d==0&&UI.show(c);c.onclick=function(){MI.app({Capture:function(){if(MI.Capture&&MI.Capture.enable){a.flashCapture=d;UI.C(b.upPic._box,"left","-9999px");MI.Capture.screen.DoCapture();MI.Capture.screen.OnCaptureCanceled=function(){b.upPic._box.style.left=""}}else MI.confirm({title:_("你还未安装腾讯微博截屏插件"),content:_("安装后，你就可以使用截屏功能"),confirmTxt:_("安装"),confirm:function(){MI.Capture.install()}})}});return false}});a.resetSourcePic=function(){UI.hide(a._sourceError);a._sourcepicTxt.value="";a._sourceError.innerHTML="";a._sourcepicBtn.disabled=false};a._sourcepicBtn.onclick=a._sourcepicFrom.onsubmit=function(){var c=RegExp("((news|telnet|nttp|file|http|ftp|https)://){1}(([-A-Za-z0-9]+(\\.[-A-Za-z0-9]+)*(\\.[-A-Za-z]{2,5}))|([0-9]{1,3}(\\.[0-9]{1,3}){3}))(:[0-9]*)?(/[-A-Za-z0-9_\\$\\.\\+\\!\\*\\(\\),;:@&=\\?/~\\#\\%]*)*","i"),d=[_("你输入的图片链接已提交，请等待"),_("图片地址不能为空，请在输入框粘贴或输入"),_("你输入的图片地址不是正确的URL格式，请重新输入")];a._sourcepicValue=UI.trim(a._sourcepicTxt.value);if(c.test(a._sourcepicValue)){a._sourcepicBtn.disabled=true;a._sourceError.innerHTML=d[0];UI.show(a._sourceError);MI.ajax({url:MI.url.uploadUrlPic,type:"get",data:"sourcepic="+encodeURIComponent(a._sourcepicValue),success:function(c){c=MI.json(c);if(c.result==0&&c.info){a.hide();b.addPic({result:0,msg:_("上传成功"),info:{image:c.info.image,fileName:_("链接.jpg")}});!UI.hasClass(b._sendCnt,"hasMedia")&&UI.addClass(b._sendCnt,"hasMedia")}else a._sourcepicBtn.disabled=false;a._sourceError.innerHTML=c.msg}})}else{a._sourcepicTxt.focus();a._sourceError.innerHTML=!a._sourcepicValue?d[1]:d[2];UI.show(a._sourceError)}MI.Bos("btnSourcePic");return false};a._picForm.reset();if(MI.user.fun.qbUpload){d="http://wbupload://t.qq.com/asyn/updateGrabPic.php?retType=1&cookiejs=MI.TalkBox.cur.qbUploadCookie&successjs=MI.TalkBox.cur.qbUploadAddPic&positionjs=MI.TalkBox.cur.qbUploadPosition";a._qbPicUploadBtn=e(a._picForm,"input")[0];a._picForm.removeAttribute("target");a._qbPicUploadBtn.onclick=function(){a.PicUpTime=+new Date;a._picForm.submit();a.hide();MI.TalkBox.cur=b;MI.Bos("btnPic")}}else UI.A(a._picForm,"target",c);UI.A(a._picForm,"action",d);a.picChange=function(){var c=this.value.toLowerCase();if(!/\.(png|jpg|jpeg|gif)$/.test(c)){MI.alert(_("仅支持jpg、jpeg、gif、png图片文件"));return false}b.uploadPic();a.PicUpTime=+new Date;a._picForm.submit();MI.TalkBox.cur=b;MI.Bos("btnPic")};a._picBtn.onchange=a.picChange;a._picDel.onclick=function(){b.delPic();MI.Bos("btnPicDel");return false};a._picCancel.onclick=function(){b.cancelPic();MI.Bos("btnPicCancel");return false}},showEvent:function(){},tabEvent:function(c,d){var h=e(c._box,".singlePic .cnt_2_swf")[0];if(h){h.innerHTML="";var m=window._jsflash_singlePic(),i=m&&m.length>4?215:120;if(m&&m.length>0)UI.show(e(b._box,".singlePic .cnt_2_opt")[0]);else{b.newPicObj.PicFilter=0;UI.hide(e(b._box,".singlePic .cnt_2_opt")[0])}h.innerHTML=b.newMultiPicFun?MI.Flash.getObject(null,MI.swf.NewMultiPic,468,i,b.ShuoShuoUploader,"facadeId=callbacks&filter="+b.newPicObj.PicFilter+"&subSwfPath="+encodeURIComponent(MI.swf.MultiBeautify)+"&maxFileNum=9&screenCaptureEnabled=1&fgColor=749220&bgColor=16777215&activeColor=15921906&uploadCheatMode=1&returnType=jsontype&uploadMethod=loop&picPreUrl="+c._picPreUrl+"&uploadUrl="+encodeURIComponent(MI.url.uploadGrabPic+"?call=2&uin="+MI.user.uin)+"&intrallCaptureUrl="+encodeURIComponent("http://mail.qq.com/cgi-bin/readtemplate?t=browser_addon&check=false&s=install&returnto=http://home.pengyou.com/index.php?mod=group")):MI.Flash.getObject(null,MI.swf.ShuoShuoUploader,464,i,b.ShuoShuoUploader,"facadeId=callbacks&maxFileNum=9&screenCaptureEnabled=1&fgColor=749220&bgColor=16777215&activeColor=15921906&uploadCheatMode=1&returnType=jsontype&uploadMethod=loop&picPreUrl="+c._picPreUrl+"&uploadUrl="+encodeURIComponent(MI.url.uploadGrabPic+"?call=2&uin="+MI.user.uin)+"&intrallCaptureUrl="+encodeURIComponent("http://mail.qq.com/cgi-bin/readtemplate?t=browser_addon&check=false&s=install&returnto=http://home.pengyou.com/index.php?mod=group"))}if(d==1||d==2||d==4){var n=c._div[d],j=["","PhotoMultiUpload","Text2Pic","","PhotoCameraUpload"][d],h=["","btnPhotoMulti","","btnText2Pic","btnPhotoCamera"][d];MI.app({TalkBoxRich:function(){MI[j].build(n,"http://api.t.qq.com/asyn/updateGrabPic.php");MI.TalkBox.cur=b}});h=="btnPhotoMulti"&&MI.Bos2Open("170278","2.0","101");MI.Bos(h)}else if(d==3)c._sourcepicTxt.focus();else if(d==5){MI.SearchPic.builded||MI.SearchPic.build(b);MI.SearchPic.show();MI.Bos("btnPicSearch")}if(d==0||d==1)try{c._picBtn.focus()}catch(f){}c.flashCapture=0;b.curPicTab=a[d]},hideEvent:function(a){a.resetSourcePic&&a.resetSourcePic();MI.app({TalkBoxRich:function(){MI.PhotoMultiUpload&&MI.PhotoMultiUpload.clear();MI.PhotoCameraUpload&&MI.PhotoCameraUpload.clear()}})}});if(MI.user.fun.newSinglePicUpload&&!MI.user.fun.newPicUpload){UI.hide(b.upPic._tab[0]);b.upPic.show(1)}};if(!MI.user.fun.qbUpload&&UI.hasClass(document.body,"ipad")&&!UI.B.os6)return UI.B.ipad?alert(_("此浏览器暂不支持图片上传，请到App Store下载并安装腾讯微博免费客户端。")):alert(_("此浏览器暂不支持图片上传，建议您使用QQ浏览器。")),MI.Bos("btnPicDisable"),UI.E(a).stop(),!1;b.picUploadBuild()}b.upPic.show(0);MI.user.fun.newSinglePicUpload&&!MI.user.fun.newPicUpload&&b.upPic.switchTab(1);b._picLink&&UI.A(b._picLink,"moAble","0")}},".autoBackspace":function(a,b){var c=b._txt.value.length,d=MI.TalkBox.prototype.txtMax,h=b._txt.value.split("||");if(b.zhCount)if(MI.string.length(h[0])>=d)b._txt.value=h[0],MI.selectTxt(b._txt,c,c,c);else{for(;MI.string.length(h.join("||"))>2*d-20;)h.pop();b._txt.value=h.join("||");MI.selectTxt(b._txt,0,0,0)}else if(h[0].length>=d)b._txt.value=h[0],MI.selectTxt(b._txt,c,c,c);else{for(;h.join("||").length>d-20;)h.pop();b._txt.value=h.join("||");MI.selectTxt(b._txt,0,0,0)}b.countTxt();UI.hide(this);b._txt.focus();MI.Bos("btnAutoBackspace")},".schBrace .txt":function(a,b){var c;UI.hasClass(this,"disabled")||(b.type||(c=e(b._body,".insertFace")[0],MI.TalkBox._tipKeyWord||(MI.TalkBox._tipKeyWord=UI.html('<div id="ban_keyword" class="tip_pop  tip_pop_hand_up"><div class="tip_pop_in clear" style="display:block;"><div class="tip_pop_cont"><p class="tip_pop_info">在｛｝里输入关键词，把你的兴趣、关注点分享给大家，点击关键词查看更多精彩，分享关键词会自动订阅到关键词列表。</p></div><a href="#" class="tip_pop_remove closeTip" title="关闭">×</a></div></div>')[0],MI.TalkBox._tipKeyWord.style.zIndex="999",MI.TalkBox._tipKeyWord.style.width="195px",MI.TalkBox._tipKeyWord.onclick=function(a){UI.E(a).stop()},UI.EA(document.body,"click",function(){f("ban_keyword")&&UI.fireEvent(e(MI.TalkBox._tipKeyWord,".closeTip")[0],"click")})),MI.TalkBox._tipKeyWord.style.top=UI.getY(c)-9+"px",MI.TalkBox._tipKeyWord.style.left=UI.getX(c)+0.5+"px",UI.append(MI.TalkBox._tipKeyWord,document.body),MI.buildTip({id:"ban_keyword"})),b.hideMedia(),(c=UI.A(this,"content"))&&(c="{"+c+"}"),b.addKeyword(null,{defaultTxt:c}),a.stop())},".text2PicBtn a, .longWB .txt":function(a,b){MI.TalkBox.cur=b;if(!MI.user.fun.hasLongtxtBlog)return b.events[".btnTextToPic"].call(this,a,b),!1;MI.TalkBox.addList=b.addList;MI.Bos("btnLongWB");MI.TalkBox.longWBDom||(MI.TalkBox.longMicroBlog={},MI.TalkBox.longWBDom=UI.html('<div class="d_lgwb_form"><form id="formLongWB" method="post" target="_blank" action="http://p.t.qq.com/longweibo/index.php" style="display:none"><input style="hidden" name="title" value><input style="hidden" name="content" value></form><div class="input"><div class="row clear title"><div class="atr">标题：</div><div class="cnt"><input type="text" class="input_text input_text_tit" value="请输入标题，最多30字(选填)" maxlength=30></div></div><div class="row clear"><div class="atr">正文：</div><div class="cnt"><div class="edit_frame" style="'+(UI.B.ie6?"":"height:355px;")+'"></div></div></div><div class="row clear"><span class="atr_text">提醒朋友来看：</span><span boss="btnSeleFrd"><input type="text" id="itemSelect" class="input_text input_text_frds" value="" /></span></div><span class="loading_mask" style="display:none"></span><div class="row_ft clear"><span class="error_text" style="display:none"></span><a href="#" class="view_link">预览</a><span class="jsSending" style="display:none"><span class="loading2"></span> <span class="c_tx5">广播中，请耐心等待...</span></span><label class="gb_btn gb_btn1" id="sendLongWB"><button type="button" class="t confirm sendBtn">发布长微博</button></label></div></div></div>')[0],UI.css(".d_lgwb_form {padding: 25px 10px 23px 10px;position: relative}.d_lgwb_form2 {padding: 20px 10px 12px;}.D .d_lgwb_form2 .talkWrap .inputTxt{ height:60px;}.d_lgwb_form .row {padding-bottom: 16px;}.d_lgwb_form .atr {float: left;line-height: 24px;}.d_lgwb_form .cnt {border:1px solid #CECECE;overflow: hidden;zoom:1;float:left;}.d_lgwb_form .input_text {padding: 3px 6px;height: 18px;line-height: 18px;background: #fff;color: #999;border:none;}.d_lgwb_form .focus .input_text {color: #333;}.d_lgwb_form .input_text_tit { width: 475px}.d_lgwb_form .edit_frame {width: 487px;}.d_lgwb_form .input_text_frds { width: 429px; }.d_lgwb_form .row_ft {text-align: right; min-height: 22px; _height: 22px; position: relative;}.d_lgwb_form .row_ft span,.d_lgwb_form .row_ft a {display: inline-block; vertical-align: middle;}.d_lgwb_form .row_ft .gb_btn {margin-left: 10px; vertical-align: middle;}.d_lgwb_form .row_ft .error_text {color: #E56C0A;}.d_lgwb_form .row_ft .view_link {margin-left: 5px;}.d_lgwb_form .row_ft .count_text em {font-size: 24px;font-family: Georgia,Tahoma,Arial;}.d_lgwb_form .row_ft .loading2 {display: inline-block; width: 16px;height: 16px;vertical-align: middle;}.d_lgwb_form .loading_mask {display: block;background: #fff;position: absolute;left: 0;top: 0;\theight: 520px;width: 100%;filter: alpha(opacity=50);opacity: 0.5;}.d_lgwb_form .qmEditorBase{border: 0;}.d_lgwb_form .qmEditorBaseBd { border-top: 0;_display:none;}.d_lgwb_form2 .talkWrap .cont{ _position:static;}.DWrap .qmEditorContent{_padding-bottom:0;}.D .d_lgwb_form2 .talkWrap .txtShadow {width:98%;height:60px;}.d_lgwb_form .selectWrap {border-color: #CECECE!important;}"),MI.TalkBox.preview=e(MI.TalkBox.longWBDom,".view_link")[0],MI.TalkBox.loading=e(MI.TalkBox.longWBDom,".jsSending")[0],MI.TalkBox.mask=e(MI.TalkBox.longWBDom,".loading_mask")[0],MI.app({ItemSelect:function(){MI.TalkBox.itemSelect=new MI.ItemSelect({target:f("itemSelect"),maxHeight:114,defaultValue:"输入名字/帐号(选填)",dataUrl:MI.url.userFriends,queryData:{u:MI.user.account,t:"4,3,2,1,5"},noResultTip:"你还没有好友",noSearchTip:"没有找到匹配的好友"});MI.TalkBox.itemSelect.pullData();MI.TalkBox.itemSelect.hide()},QmEditor:function(){MI.TalkBox.longMicroBlog.title=e(MI.TalkBox.longWBDom,".input input")[0];MI.TalkBox.longMicroBlog.titleDiv=e(MI.TalkBox.longWBDom,".title")[0];MI.TalkBox.longMicroBlog.title.onfocus=function(){UI.hasClass(MI.TalkBox.longMicroBlog.titleDiv,"focus")||(MI.TalkBox.longMicroBlog.title.value="",UI.addClass(MI.TalkBox.longMicroBlog.titleDiv,"focus"));MI.TalkBox.longMicroBlog.emptyTitle&&(UI.hide(MI.TalkBox.longMicroBlog.tip),MI.TalkBox.longMicroBlog.emptyTitle=0)};MI.TalkBox.longMicroBlog.title.onblur=function(){MI.TalkBox.longMicroBlog.title.value=MI.TalkBox.longMicroBlog.title.value.replace(/^\s+/,"");MI.TalkBox.longMicroBlog.title.value||(UI.removeClass(MI.TalkBox.longMicroBlog.titleDiv,"focus"),MI.TalkBox.longMicroBlog.title.value="请输入标题，最多30字(选填)")};MI.TalkBox.longMicroBlog.abstractGenerate=function(a,b){var h=MI.TalkBox.itemSelect.getResult().nameList.slice(0,5).join(" ")+" 我发表了一篇#长微博#，欢迎围观："+(b?"《"+b+"》，":"");MI.TalkBox.txtLongWB=h+MI.string.cut(a,2*(138-MI.string.length(h)/2-20)).replace(/\r?\n/g," ")};MI.TalkBox.longMicroBlog.tip=e(MI.TalkBox.longWBDom,".error_text")[0];MI.TalkBox.longMicroBlog.showTip=function(a){MI.TalkBox.longMicroBlog.tip.innerHTML=a;UI.hide(MI.TalkBox.preview);UI.show(MI.TalkBox.longMicroBlog.tip);var b=setTimeout(function(){UI.hide(MI.TalkBox.longMicroBlog.tip);UI.show(MI.TalkBox.preview);clearTimeout(b)},3E3)};UI.EA(MI.TalkBox.preview,"click",function(a){UI.E(a).prevent();MI.Bos("btnScanLongWB");var a=f("formLongWB"),b=UI.children(a);b[0].value=UI.hasClass(MI.TalkBox.longMicroBlog.titleDiv,"focus")?MI.TalkBox.longMicroBlog.title.value:"";b[1].value=MI.TalkBox.qmEditor.getContent();a.submit()});UI.EA(e(MI.TalkBox.longWBDom,".confirm")[0],"click",function(){MI.Bos("btnUploadLongWB");var a=MI.TalkBox.qmEditor.getContent(1).replace(/^[\s\u3000]+/,""),d=UI.hasClass(MI.TalkBox.longMicroBlog.titleDiv,"focus")?MI.TalkBox.longMicroBlog.title.value:"",h=MI.string.length(a),e,i=0;if(0==h&&!/<img[^>]*>/.test(MI.TalkBox.qmEditor.getContent().toLowerCase()))return MI.TalkBox.longMicroBlog.showTip("请编辑正文内容"),!1;if(2E4<h)return MI.TalkBox.longMicroBlog.showTip("正文超过2万字"),!1;h=MI.TalkBox.qmEditor.getContent();UI.hide(MI.TalkBox.preview);UI.show(MI.TalkBox.loading);UI.show(MI.TalkBox.mask);e=new Date;MI.TalkBox.longMicroBlog.abstractGenerate(a,d);MI.TalkBox.data={content:MI.TalkBox.txtLongWB,longTitle:d,longContent:h,type:0,pass:-103};MI.TalkBox.sendLongWB=function(){MI.TalkBox.ajax=MI.ajax({url:MI.url.talkPublish,type:"post",data:MI.TalkBox.data,success:function(a){a=MI.json(a);i=new Date-e;MI.Speed("t_asyn_longwb2pic",1,i);UI.hide(MI.TalkBox.loading);UI.hide(MI.TalkBox.mask);UI.show(MI.TalkBox.preview);if(0==a.result){if(MI.TalkBox.addList&&a.info){MI.TalkBox.itemSelect.resetAllData();MI.TalkBox.itemSelect.hide();UI.fireEvent(MI.TalkBox.itemSelect.searchInput,"blur");MI.TalkBox.longWBDialog.hide();b._txt.value="";b.countTxt();MI.tip("发送成功！");var c=a.info.talk[0],d=MI.user;c.pic=d.pic;c.nick=c.nick||d.name;c.name=c.name||d.account;c.chName=c.chName||d.chName;c.flag=c.flag&&UI.isArray(c.flag)?d.flag:c.flag;MI.TalkBox.addNewMsg(a,0,MI.talkList)}MI.TalkBox.longWBDialog.hide()}else MI.code.check(a.result)?MI.code.show({msg:a.msg,code:a.info,call:function(a){MI.TalkBox.data.veriCode=a;MI.TalkBox.sendLongWB()}}):MI.TalkBox.longMicroBlog.showTip(a.msg)}})};MI.TalkBox.sendLongWB()})}}));MI.TalkBox.cur=b;MI.TalkBox.longWBDialog||(MI.TalkBox.longWBDialog=new MI.Dialog);MI.TalkBox.longWBDialog.show({title:'<h3 class="DmainTit">'+_("长微博")+"</h3>",width:585,html:MI.TalkBox.longWBDom,start:function(){UI.show(MI.TalkBox.preview);UI.hide(MI.TalkBox.loading);UI.hide(MI.TalkBox.mask);UI.hide(MI.TalkBox.longMicroBlog.tip);MI.app({QmEditor:function(){MI.TalkBox.longMicroBlog.title.value="";UI.fireEvent(MI.TalkBox.longMicroBlog.title,"blur");MI.TalkBox.qmEditor=new MI.QmEditor({target:e(MI.TalkBox.longWBDom,".edit_frame")[0],value:MI.string.html(b._txt.value),height:"328px",callback:function(a){a._mEditDoc.onmousedown=function(){MI.TalkBox.itemSelect&&MI.TalkBox.itemSelect.hide()};if(UI.B.ie6)var b=setTimeout(function(){UI.C(a._mEditBody,"padding","0");clearTimeout(b)},200);else UI.C(a._mEditBody,"padding","0")},funclist:{toolbar:"Bold Italic Underline | FontName FontSize ForeColor BackColor | AlignMode Serial Indent | CreateLink Photo ScreenSnap"}})}})},closeEnd:function(){if(MI.TalkBox.qmEditor.getContent(1).replace(/^\s+/,"")||/<img[^>]*>/.test(MI.TalkBox.qmEditor.getContent().toLowerCase()))MI.Text2Pic.confirmCancel("longWBDialog",MI.TalkBox);else{MI.TalkBox.qmEditor.getEditor()&&MI.TalkBox.qmEditor.getEditor().hideMenu();MI.TalkBox.itemSelect.resetAllData();MI.TalkBox.itemSelect.hide();UI.fireEvent(MI.TalkBox.itemSelect.searchInput,"blur");MI.TalkBox.ajax&&MI.TalkBox.ajax.abort();MI.TalkBox.longWBDialog.hide()}return true}});a.stop();a.prevent()}};MI.TalkBox.prototype.addEvent=function(){var a=this;if(!a.addEvented){a._pic=a.$(".uploadPic .txt");a._retweetPic=a.$(".filePrew");a._syncQzoneUnite=a.$(".synchFrm .txt.diary");a._syncQzone=a.$(".replayQzoneCheckbox");a._syncQQSign=a.$(".synchFrm .txt.qq");a._more=a.$(".smoreFun");a._moreBox=e(a._more,".moreBox")[0];a._moreAnchor=e(a._more,".more")[0];a._moreDropBox=e(a._more,".dropBox")[0];a._sendCnt=a.$(".sendCnt")||a._body;a._autoBackspace=a.$(".autoBackspace");a._sendStatus=a.$(".sendStatus")||UI.DC("div");var b=function(){a.sending||a.countTxt()},c=function(c){var d=UI.E(c);if(!a.startTime&&c&&(c=d.type,"input"==c||"paste"==c||"cut"==c||c.hasString("key")))a.startTime=+new Date,MI.ajax({url:MI.url.notice,type:"get",data:"op=1"});clearTimeout(a.delay.count);d.target==a._txt&&a.guideTextRemove();a.delay.count=setTimeout(b,75)};UI.EA(a._txt,"keypress",c);UI.EA(a._txt,"input",c);UI.EA(a._txt,"paste",c);UI.EA(a._txt,"cut",c);a._txt.onbeforeeditfocus=c;a._body.onkeydown=function(b){if(!a.sending)if(b=UI.E(b),b.ctrl&&13==b.key)a.sending=1,c(),a.send(),MI.Bos("btnCtrlEnter");else if(86==b.key&&b.ctrl){if((a._pic||e(a._body,".uploadPic .txt")[0])&&b.target==a._txt&&!a.installCapturePluginTip)a.tmpTxt=a._txt.value;a.isCtrlV=1}};a._body.onkeyup=function(b){var d=UI.E(b);a.sending||c();if((d.ctrl&&86==d.key||a.isCtrlV)&&!a.type){MI.TalkBox.cur=a;var i=a._pic||e(a._body,".uploadPic .txt")[0];i&&d.target==a._txt&&a.tmpTxt==a._txt.value&&MI.app({Capture:function(){UI.fireEvent(i,"click");a.hideMedia();!MI.Capture||!MI.Capture.enable?a.installCapturePluginTip||d.target!=a._txt||(MI.confirm({title:_("你想直接粘贴图片吗？"),content:_("安装截屏插件，就可以在输入框中粘贴图片并随时截屏"),confirmTxt:_("安装"),confirm:function(){MI.Capture.install()}}),a.installCapturePluginTip=1):MI.Capture&&MI.Capture.uploader&&(a.upPic&&(a.upPic.flashCapture=0),MI.Capture.upload())}});a.isCtrlV=0}};UI.hasClass(a._txt,"noAutoCmt")||setTimeout(function(){MI.app({Base:function(){a.autoCmt=new MI.AutoCmt({target:a._txt,key:1,topic:1,face:1,tips:a.tips?a.tips:1,call:function(){c()}})}})},50);a._more&&(a._moreAnchor.onclick=function(){UI.addClass(a._moreBox,"sopen");a._microTpcCtn&&UI.hide(a._microTpcCtn);return!1},a._moreBox.onmouseover=function(){clearTimeout(a.delay.moreBox)},a._moreBox.onmouseout=function(){a.delay.moreBox=setTimeout(function(){UI.removeClass(a._moreBox,"sopen")},200)});if(MI.user.fun.feelTip&&a.feelTip){var d=e(a._body,".ico_feel")[0];d&&(a._moodIco=d,UI.A(d.parentNode,"title",_("跳动的小心脏提醒你记录每日心情")),d.innerHTML='<img src="http://mat1.gtimg.com/www/mb/images/feel.gif">',setTimeout(function(){if(d.innerHTML!=""){UI.A(d.parentNode,"title",_("心情"));d.innerHTML=""}},15E3))}if(a._syncQzoneUnite||a._syncQzone){if(a._syncQzoneUnite&&(a._sico=e(a._syncQzoneUnite,".sico")[0],a.toogleSyncQzone=function(b){a._sico.className=b?"sico ico_diary":"sico ico_diary_gray";a._syncQzoneUnite.title=b?_("已同步至QQ空间"):_("未同步至QQ空间");a.data.syncQzone=b*1},a._syncQzoneUnite.onclick=function(){MI.ajax({type:"get",url:MI.url.syncQzoneSet,data:{ss:!MI.user.fun.syncQzone*1,t:2},success:function(b){b=MI.json(b);if(b.result==0){MI.user.fun.syncQzone=!MI.user.fun.syncQzone*1;a.toogleSyncQzone(MI.user.fun.syncQzone*1)}}});MI.Bos("btnSyncQzoneUnite");return false},a.toogleSyncQzone(1*!!MI.user.fun.syncQzone)),a._syncQzone)a.syncQzoneOld?(a.data.share=1*a._syncQzone.checked,a.data.syncQzone=0):(a.data.syncQzone=1*a._syncQzone.checked,a.data.share=0),a._syncQzone.onclick=function(){if(a.syncQzoneOld){a.data.share=this.checked*1;MI.Bos("btnShareQzoneCheckBox")}else{a.data.syncQzone=this.checked*1;MI.Bos("btnSyncQzoneCheckBox")}}}else a.data.syncQzone=0;a._syncQQSign?(a._sicoQQ=e(a._syncQQSign,".syn_qq_icn")[0],a.toogleSyncQQSign=function(b){a._sicoQQ.className=b?"syn_qq_icn":"syn_qq_icn syn_qq_gray";a._sicoQQ.title=b?_("已同步至QQ签名，最多同步50个汉字"):_("未同步至QQ签名");a.data.syncQQSign=b*1},a._syncQQSign.onclick=function(){MI.ajax({type:"get",url:MI.url.myViewSettingSave,data:{syncQQSign:!MI.user.fun.syncQQSign*1},success:function(b){b=MI.json(b);if(b.result==0){MI.user.fun.syncQQSign=!MI.user.fun.syncQQSign*1;a.toogleSyncQQSign(MI.user.fun.syncQQSign*1)}}});MI.Bos("btnSyncQQSignUnite");return false},a.toogleSyncQQSign(1*!!MI.user.fun.syncQQSign)):a.data.syncQQSign=0;a._addReply&&(a._addReply.onclick=function(b){if(UI.E(b).target.nodeName=="A"){UI.hide(this);a._txt.value="";a.focus();MI.Bos("btnAddReply")}return false});a._addComt&&(a._addComt.onclick=function(){a._txt.focus();return false});a._retweetPic&&(a._rtPicAnchor=UI.parent(a._retweetPic),a._rtPicForm=UI.parent(a._rtPicAnchor),a._rtPicWrap=UI.parent(a._rtPicForm),a._rtPicWrap.style.display=MI.user.fun.rtPicPub&&(1==a.type||4==a.type||5==a.type)?"":"none",a._retweetPic.onchange=function(){if(this.disabled)return false;var b=this.value.toLowerCase(),c=a._rtPicWrap,d,e=-1,f=a.talkId,o=MI.TalkList.rtPics[a.talkId],l=a._txt.value;o||(MI.TalkList.rtPics[a.talkId]=o={});if(!/\.(png|jpg|jpeg|gif)$/.test(b)){MI.alert(_("仅支持jpg、jpeg、gif、png图片文件"));return false}for(d=1;d<10;++d)if(!o[d]||!l.hasString("[image"+d+"]")){o[d]=null;e=d;break}if(e===-1){MI.confirm({type:"warning",title:_("最多包含9张图片"),content:_("请在发表框中删除 [imageN] 来删除图片"),confirmTxt:_("知道了"),confirm:function(){MI.dialog.hide()},cancelTxt:""});return false}b=b.substr(b.lastIndexOf("\\")+1);b=b.substr(0,b.lastIndexOf(".")+1);statusELs=UI.html('<div class="sendList uploadPicLoader"><i class="ic_loader"></i></div><div class="sendList uploadPicSuccess"><i class="ic ic_pic"></i> [image'+e+'] <a href="javascript:;" class="ffsong" title="删除">×</a></div>');UI.hide(c);UI.after(statusELs[0],c);a._retweetPic.used=e;MI.TalkBox.cur={addPic:function(b){var c,d;if(b.result==0&&f===a.talkId){a._retweetPic.disabled=true;UI.hide(statusELs[0]);UI.after(statusELs[1],statusELs[0]);UI.remove(statusELs[0]);c=UI.GC(statusELs[1],"a")[0];d=UI.GC(statusELs[1],"i")[0];c.onclick=function(){o[e]=null;o.key=null;a._txt.value=a._txt.value.replace(RegExp("\\[image"+e+"\\]","g"),"");MI.selectTxt(a._txt,0,0,0);a._resetRtPic();MI.Bos("btnDelRtPics")};UI.A(d,"data-rpid",e);UI.A(d,"data-rpurl",b.info.image);d.onmouseover=function(){MI.TalkList.showPicPreview(d)};a.addTopic(" [image"+e+"]");o[e]=b.info.image;o.key=e}else if(b.result!=0){MI.alert(b.msg||_("图片上传失败，请稍后重试"));o[e]=null;o.key=null;a._resetRtPic()}}};b=a._rtPicForm;b.action="http://upload.t.qq.com/asyn/uploadpic.php";b.submit();MI.Bos("btnUploadRtPics")});a.type&&MI.user.fun.hasbrace&&UI.show(a.$(".schBrace"));a._btn.onclick=function(){if(!UI.hasClass(this,"btnNoStr")&&(!MI.user.fun.sendBtnDisabledOnNoText||!UI.hasClass(a._btn,"disabled"))){var b=e(a._sendStatus,".pidLoad.loading")[0],c=a.$(".insertFun .uploadPicLoader");if(UI.hasClass(this,"btnHasStr")&&b&&b.style.display!="none"||c){MI.Bos("btnSend_UploadingPic");MI.app({Base:function(){MI.confirm({title:_("确定发送？"),content:_("图片还在上传中，请耐心等待；<br>如果直接发送，微博中将不含有图片。"),confirmTxt:_("耐心等待"),confirm:function(){MI.dialog.hide();MI.Bos("wait_uploadingPic")},cancelTxt:_("直接发送"),cancel:function(){MI.dialog.hide();a.countTxt();a.send();MI.Bos("send_uploadingPic")}})}})}else{a.countTxt();a.send();switch(a.type){case null:a.boxType=="recom"&&MI.Bos("btnSendRecom");MI.Bos("btnSend","",0.01);break;case 1:MI.Bos("btnSendRelay");break;case 2:a.boxType=="trans"?MI.Bos("btnSendTrans"):MI.Bos("btnSendReply","",0.01);break;case 3:MI.Bos("btnSendMsg");break;case 4:MI.Bos("btnSendRelayList");break;case 5:MI.Bos("btnSendComt");break;case 6:MI.Bos("btnSendNotepad");break;case 7:a.boxType=="reFollow"&&MI.Bos("btnSendReFollow")}}}};a.otherCheck.push(function(){if(MI.TalkBox.overFlow&&UI.hasClass(UI.next(a._btn),"text2PicBtn")){MI.confirm({title:_("超出字数限制，是否转成长微博发布？"),content:"",confirmTxt:_("是"),confirm:function(){MI.dialog.hide();UI.fireEvent(e(UI.next(a._btn),"a")[0],"click")},cancelTxt:_("否")});return false}return true});a.addEvented=1}};MI.TalkBox.topic={};MI.TalkBox.prototype.cacheTopic=function(a){var b="option_topic_"+MI.user.account,c=0,d=[],e=MI.json(MI.S(b)),m={},a=a.match(/(#\s*[^#\s]{1}[^#]{0,39}?\s*#)/g),i;a&&UI.each(a,function(a){i=encodeURI(a);m[i]=1;delete e[i]});for(var n in e)n&&(m[n]=1);MI.TalkBox.topic=m;d.push("{");for(n in m){if(5<c)break;d.push((0==c?"":",")+'"'+n+'":1');c++}d.push("}");MI.S(b,d.join(""))};MI.TalkBox.prototype.addVote=function(){var a=this;if(!a.upVote){var b='<div class="voteDiv"><div class="m_voteBox clear">\t<form action="'+MI.url.vote+'" onsubmit="return false" name="voteAddFrom" id="voteAddFrom" target="voteAddIframe" method="post">\t<table><tr class="voteAddTr"><th>'+_("标题：")+'</th><td valign="top"><input type="text" name="sbjtitle" id="sbjtitle" class="inputTxt"><br><a href="#" class="ffsong addBrief">+'+_("添加说明")+'</a></td><td valign="top"><span class="voteAddError"></span></td></tr><tr class="voteAddTr" style="display:none"><th></th><td valign="top"><div><textarea name="brief" id="brief" class="inputTxt"></textarea></div></td><td valign="top"><span class="voteAddError"></span></td></tr><tr class="voteAddTr"><th>'+_("类型：")+'</th><td valign="top"><label><input class="check1" type="radio" name="ftype" id="ftype" value="1" checked>'+_("单选")+'</label> <label><input class="check1" type="radio" name="ftype" value="2">'+_("多选")+'</label></td><td><b class="voteAddError"></b></td></tr><tr class="voteAddTr"><th>'+_("选项：")+'</th><td valign="top">\t<ul><li><span class="index">1.</span><input type="text" name="opttitle" id="opttitle" class="inputTxt"></li><li><span class="index">2.</span><input type="text" name="opttitle" class="inputTxt"><div></div></li><li><span class="index">3.</span><input type="text" name="opttitle" class="inputTxt"><div></div></li><li><span class="index">4.</span><input type="text" name="opttitle" class="inputTxt"><div></div></li>\t</ul>\t<a href="#" class="voteAddOption ffsong">+'+_("增加选项")+'</a></td><td valign="top"><span class="voteAddError cNote"></span></td></tr>\t</table>\t<div class="right"><label class="gb_btn gb_btn1"><input type="submit" class="t btnSend" value='+_("确定")+'></label></p>\t</form></div><p class="cError" style="display:none"></p><iframe id="voteAddIframe" name="voteAddIframe" src="about:blank" style="display:none"></iframe>\t</div>';a.uploadCollection({type:null,name:"Vote",tab:[_("投票")],cnt:b,query:".voteDiv",className:"insertVote",flashTab:[],_open:a._vote,buildEvent:function(b){b._voteForm=f("voteAddFrom");b._voteOptions=e(b._box,"td ul")[0];b._voteAddOption=e(b._box,".voteAddOption")[0];b._addBrief=e(b._box,"a.addBrief")[0];UI.GT(b._tab[0],"a")[0].style.cssText="cursor:default;text-decoration:none";b._voteAddOption.onclick=function(){18<=e(this.parentNode,"li").length&&UI.hide(this);a.addVoteOption(b);return!1};b._addBrief.onclick=function(){var a=f("brief"),b=a.parentNode.parentNode.parentNode;a.value="";UI.toggle(b);this.innerHTML=this.innerHTML=="+"+_("添加说明")?"-"+_("不需要说明了"):"+"+_("添加说明");e(b,".voteAddError")[0].innerHTML="";try{a.focus()}catch(c){}return!1}},showEvent:function(b){MI.app({Validate:function(){new MI.Validate({id:"voteAddFrom",inputs:{sbjtitle:{rule:function(a){var a=UI.trim(a),b=a.length;a.split("");if(0==b)return _("这里一定要填")},noIco:!0},brief:{noIco:!0},ftype:{noIco:!0},opttitle:{rule:function(a,b){a=UI.trim(a);a.split("");var c=e(f("opttitle").parentNode.parentNode,"input"),i=0;UI.each(c,function(a){(value=UI.trim(a.value))&&i++});if(2>i&&b)return _("至少两个选项")},result:function(){var a=[],b=e(f("opttitle").parentNode.parentNode,"input"),c;UI.each(b,function(b){(c=UI.trim(b.value))&&a.push(c)});return a.join("||")},noIco:!0}},messages:function(a){return e(UI.parents(a,"voteAddTr")[0],".voteAddError")[0]},success:function(d){0==d.result?(a.addTopic(_("我发起了一个投票【{0}】，地址：",d.info.title)+"http://url.cn/"+d.info.url),a.focus(),a.vote=d.info.voteid,a.resetVote(b),b.hide()):d.msg&&MI.alert(d.msg)}})}})}})}a.upVote.show(0)};MI.TalkBox.prototype.addVoteOption=function(a){var b=UI.html('<li><span class="index"></span><input type="text" name="opttitle" class="inputTxt"><div></div></li><li><span class="index"></span><input type="text" name="opttitle" class="inputTxt"><div></div></li>'),c=document.createDocumentFragment();UI.each(b,function(a){UI.append(a,c)});UI.append(c,a._voteOptions);if(a=e(a._box,"li .index"))for(var b=0,d=a.length;b<d;b++)a[b].innerHTML=b+1+"."};MI.TalkBox.prototype.resetVote=function(a){UI.show(a._voteAddOption);var b=e(a._voteOptions,"input");UI.each(b,function(a,b){3<b?UI.remove(a.parentNode):a.value=""});f("sbjtitle").value="";f("brief").value="";UI.hide(f("brief").parentNode.parentNode.parentNode);f("ftype").checked=!0;a._addBrief.innerHTML="+"+_("添加说明")};MI.TalkBox.prototype.newAddPic=function(){var a=this;return new function(){var b={filename:"filename",gid:"",_skey:"",_uin:MI.Uin(),exttype:"0"},c,d={onReady:function(){c=document[MI.TalkBox.cur.ShuoShuoUploader]},screenCapture:function(){MI.app({Capture:function(){MI.Capture&&MI.Capture.enable?(a.upPic.flashCapture=2,UI.C(a.upPic._box,"left","-9999px"),MI.Capture.screen.DoCapture(),MI.Capture.screen.OnCaptureCanceled=function(){a.upPic._box.style.left=""}):MI.confirm({title:_("你还未安装腾讯微博截屏插件"),content:_("安装后，你就可以使用截屏功能"),confirmTxt:_("安装"),confirm:function(){MI.Capture.install()}})}})},onFilesSelected:function(b){a.normalPicLoaded=1;1<b&&UI.show(e(a._box,".singlePic .cnt_2_opt")[0])},onImageLoaded:function(){},upload_onComplete:function(b){a.upPic.flashCapture=0;var c=e(a._box,".singlePic .cnt_2_opt .uploadPicConfirm")[0];c&&UI.hasClass(c,"disabled")&&UI.removeClass(c,"disabled");a.delPic();UI.each(b.completeds,function(b){a.addPic({result:0,info:{image:b.url.replace("//d{1,4}$/g",""),fileName:b.name||_("图片.jpg")}})});a.sendReady&&(a.normalPicLoaded=0,a.normalPicClick=0,a._send(),a.sendReady=0)},onError:function(){a.sendReady=0;return!1},setHeight:function(a){c.height=a},setWidth:function(a){c.width=a},getUploadParams:function(){return{url:uploadUrl,params:b}},stateChange:function(){},setMaxFileNum:function(){return 30},hideBtn:function(){UI.hide(e(a._box,".singlePic .cnt_2_opt")[0])},showBtn:function(){UI.show(e(a._box,".singlePic .cnt_2_opt")[0])},startFilter:function(b,d,e){a.newPicObj.setBtnWords(2);a.newPicObj.swfW=c.width;a.newPicObj.swfH=c.height;a.newPicObj.PicFilter=1;c.width=b;c.height=d+10;a.newPicObj.filterFrom=e},update:function(b){a.delPic();UI.each(b.completeds,function(b){a.addPic({result:0,info:{image:b.url.replace("//d{1,4}$/g",""),fileName:b.name||_("图片.jpg")},isShow:!0})})}};this.bind=function(){window.callbacks=d}}};MI.TalkBox.prototype.newPic=function(){var a=this,b={swfH:120,swfW:468,PicFilter:0,filterFrom:0,setBtnWords:function(c){var d=e(a._box,".singlePic .cnt_2_opt .uploadPicConfirm")[0],h=e(a._box,".singlePic .cnt_2_opt .uploadPicCancel")[0],m=e(a._box,".singlePic .cnt_2")[0],i=e(".insertPic")[0],n=e(a._box,".info")[0];1==c?(d&&(d.value=_("上传"),UI.show(n)),h&&(h.value=_("取消")),m&&UI.C(m,"padding","10px 0 0 0")):2==c&&(d&&(d.value=_("确定"),UI.hide(n)),h&&(h.value=_("取消")),m&&UI.C(m,"padding","0"));UI.C(i,"width",20+parseInt(b.swfW)+"px")},endFilter:function(){b.setBtnWords(1);b.PicFilter=0;0==b.filterFrom&&(window.callbacks.setWidth(b.swfW),window.callbacks.setHeight(b.swfH))},cancelFilter:function(){b.setBtnWords(1);b.PicFilter=0;1==b.filterFrom&&a.hideMedia()}};return b};MI.TalkBox.prototype.delVote=function(a){this._txt.value=this._txt.value.replace(this.txtVote,"");UI.remove(this._uploadVote);1>UI.children(this._sendStatus,"sendThumbs").length&&UI.removeClass(this._sendCnt,"hasMedia");a?UI.append(this._uploadVote,this._sendStatus):this.voteModify=0};MI.TalkBox.prototype.addNewVote=function(){var a=this;a.upVote||a.uploadCollection({type:null,name:"Vote",tab:[_("文字投票"),_("图片投票")],cnt:'<div class="voteDiv" id="voteDiv"></div>              <iframe id="voteAddIframe" name="voteAddIframe" src="about:blank" style="display:none"></iframe>',query:".voteDiv",className:"insertVote",flashTab:[],_open:a._vote,buildEvent:function(b){a.initVote(b)},showEvent:function(b){UI.A(f("voteDiv"),"action",UI.A(f("voteAddFrom"),"action"));MI.app({Validate:function(){new MI.Validate({id:"voteDiv",inputs:{url:{noIco:!0},sbjtitle:{rule:function(a){var a=UI.trim(a),b=a.length;a.split("");if(0==b)return _("标题不能为空")},noIco:!0},brief:{noIco:!0},opttitle:{rule:function(a,c){if(UI.hasClass(b._tab[0],"select")){var d=e(f("wordVote"),"input.inputTxt"),j=0,o=e(f("wordVote"),".voteAddError"),l=-1;UI.each(d,function(a,b){UI.trim(a.value)?j++:-1==l&&(l=b)})}else{var d=e(f("picVote"),"input.inputTxt"),k=j=0,g=0,o=e(f("picVote"),".voteAddError"),l=-1,p=e(f("picVote"),".optpic");UI.each(d,function(a,b){var c=UI.trim(a.value),d=UI.trim(p[b].value);c&&d?j++:-1==l&&(l=b);c&&k++;d&&g++})}var d=f("ftype_select"),q;q=d.length;for(var r=d.value,s=0;s<q;s++)d.remove(0);for(s=2;s<=j;s++)q=document.createElement("option"),q.value=s,q.text="最多"+s+"项",d.options.add(q);q=document.createElement("option");q.value=0;q.text="任意";d.options.add(q);d.value=r;UI.each(o,function(a){UI.removeClass(a,"error");a.innerHTML=""});if(c){if(!UI.hasClass(b._tab[0],"select")){if(k>g)return setTimeout(function(){0!=l&&(UI.removeClass(o[0],"error"),o[0].innerHTML="");UI.addClass(o[l],"error");o[l].innerHTML=_("请上传图片")},10),_("请上传图片");if(k<g)return setTimeout(function(){0!=l&&(UI.removeClass(o[0],"error"),o[0].innerHTML="");UI.addClass(o[l],"error");o[l].innerHTML=_("请填选项描述")},10),_("请填选项描述")}if(2>j)return setTimeout(function(){0!=l&&(UI.removeClass(o[0],"error"),o[0].innerHTML="");UI.addClass(o[l],"error");o[l].innerHTML=_("至少两个选项")},10),_("至少两个选项")}return!1},result:function(){if(UI.hasClass(b._tab[0],"select")){var a=[],c=e(f("wordVote"),"input.inputTxt");UI.each(c,function(b){(b=UI.trim(b.value))&&a.push(b)})}else{var a=[],c=e(f("picVote"),"input.inputTxt"),d=e(f("picVote"),".optpic");UI.each(c,function(b,c){var e=UI.trim(b.value),h=UI.trim(d[c].value);e&&h&&a.push(e)})}return a.join("||")},onError:function(a){if(UI.hasClass(b._tab[0],"select"))var c=e(f("wordVote"),"input.inputTxt"),d=e(c[a.index].parentNode,".voteAddError")[0];else c=e(f("picVote"),"input.inputTxt"),d=e(c[a.index].parentNode,".voteAddError")[0];setTimeout(function(){d.innerHTML=a.msg;UI.addClass(d,"error")},100)},noIco:!0},optpic:{result:function(){if(UI.hasClass(b._tab[0],"select"))return"";var a=e(f("picVote"),"input.inputTxt"),c=0;UI.each(a,function(a){UI.trim(a.value)&&c++});for(var a=e(f("picVote"),".optpic"),d=[],j=0;j<a.length;j++)if(j<c){var o=UI.trim(a[j].value);o&&d.push(o)}return d.join("||")},noIco:!0},ftype:{noIco:!0},status:{result:function(){return f("status").checked?1:0},noIco:!0},end_time:{result:function(){return!f("end_time").checked?0:f("js_calendar").value+" "+f("js_hour").value+":"+f("js_min").value},noIco:!0}},messages:function(a){return"optpic"==a.id?e(a.parentNode.parentNode,".voteAddError")[0]:e(UI.parents(a,"voteAddTr")[0],".voteAddError")[0]},success:function(c){if(0==c.result){a.txtVote=_("我发起了一个投票【{0}】，地址：",c.info.title)+"http://url.cn/"+c.info.url;a.addTopic(a.txtVote);a.focus();a.vote=c.info.voteid;b.hide();a.voteModify=1;if(!a.__uploadVote){c=['<div class="sendThumbs uploadVote" style="display:;"><i class="sico ico_aVote"></i><span class="text">',_("投票"),'</span><a href="#" class="edit_link">[',_("修改"),']</a><a href="#" class="del" title="删除">[',_("删除"),"]</a></div>"].join("");a._uploadVote=UI.html(c)[0];var c=e(a._uploadVote,".del")[0],d=e(a._uploadVote,".edit_link")[0];c.onclick=function(c){c=UI.E(c);c.stop();c.prevent();a.resetVote2(b);a.delVote();MI.Bos("btnVoteDel")};d.onclick=function(b){b=UI.E(b);b.stop();b.prevent();UI.fireEvent(e(a._body,".newVote .txt")[0],"click");MI.Bos("btnLongVoteModify")}}for(var c=UI.children(a._sendStatus),d=0,f=c.length;d<f;++d)if(UI.hasClass(c[d],"uploadVote")){UI.remove(c[d]);break}UI.append(a._uploadVote,a._sendStatus);!UI.hasClass(a._sendCnt,"hasMedia")&&UI.addClass(a._sendCnt,"hasMedia")}else c.msg&&MI.alert(c.msg)}})}})},tabEvent:function(a,b){var c=e(f("voteDiv"),".voteAddOption")[0];UI.show(c);UI.removeClass(f("voteDiv"),"hideDcnt");0==b&&(UI.show(f("wordVote")),UI.hide(f("picVote")),30<=e(c.parentNode.parentNode,"ul#wordVote li").length&&UI.hide(c),MI.Bos("newVoteWord"));1==b?(UI.show(f("picVote")),UI.hide(f("wordVote")),UI.addClass(a._tab[1],"select"),31<=e(c.parentNode.parentNode,"ul#picVote li").length&&UI.hide(c),MI.Bos("newVotePic")):UI.removeClass(a._tab[1],"select");if(UI.B.ie){var d=f("picVote");pa=d.parentNode;UI.remove(d);setTimeout(function(){UI.append(d,pa)},10)}setTimeout(function(){UI.fireEvent(f("opttitle"),"blur")},10)}});a.voteModify&&(a.delVote(1),a.voteLastPage&&a.upVote.show(1));a.upVote.show(0);var b=f("sbjtitle"),c=UI.next(b.parentNode);MI.TalkBox.prototype.voteInputTip(b,c,30);var d=f("opttitle"),b=document.getElementsByName("opttitle");UI.each(b,function(a){if(a.id!="opttitle")a.onfocus=a.onblur=function(){UI.fireEvent(d,"blur");e("#picVote .voteAddError")[0].innerHTML="";e("#wordVote .voteAddError")[0].innerHTML=""}});UI.each(e("#wordVote .inputTxt"),function(a){MI.TalkBox.prototype.voteInputTip(a,e(a.parentNode,".voteAddError")[0],35,1)});UI.each(e("#picVote .inputTxt"),function(a){MI.TalkBox.prototype.voteInputTip(a,e(a.parentNode,".voteAddError")[0],20,1)})};MI.TalkBox.prototype.voteInputTip=function(a,b,c,d){var e=function(e,h){UI.addClass(b,"error");var f=MI.string.length(UI.trim(a.value)),f=Math.round(f/2);if(f<=c){if(h||0!=f||d)UI.removeClass(b,"error"),b.innerHTML=f+"/"+c}else b.innerHTML="超出"+(f-c)+"字"};UI.A(a,"evt")||(UI.EA(a,"focus",function(a){e(a,1)}),UI.EA(a,"blur",function(){b.innerHTML=""}),UI.EA(a,"keyup",function(){setTimeout(function(a){e(a)},100)}),UI.A(a,"evt",1))};MI.TalkBox.prototype.initVote=function(a){if(this.voteDom)return!1;var b=new Date,c=this;b.setDate(b.getDate()+1);MIRun(function(){MI.app({DatePicker:null})});var d=['<div class="m_voteBox clear"><div class="m_voteBox_cnt clear"><dl class="voteAddTr clear"><dt width="60">投票标题:</dt><dd><div class="voteTitle clear"><input type="text" value="" id="sbjtitle" class="inputTxt inputText" name="sbjtitle"><div class="voteUploadPic"><form id="uploadTitlePicForm" class="sPicForm" enctype="multipart/form-data" method="post" target="voteAddIframe" action="http://upload.t.qq.com/asyn/uploadpic.php"><em class="sico ico_pic ico_unpic"></em><a class="vote_filePrew"><input type="file" tabindex="3" title="支持jpg、jpeg、gif、png格式，文件小于5M" size="3" name="pic" class="filePrew" id="uploadTitlePic"></a></form></div></div><span class="voteAddError error"></span><div style="display:none" class="sendStatus clear votesendStatus"><div class="sendThumbs uploadPicS"><input id="url" type="text" style="display:none"/><span class="pidLoad loading" style="display: none; ">上传中<a href="#" class="cancel">[取消]</a></span><span style="display:none" class="preview"><span class="link"><em class="sico ico_pic"></em><a target="_blank" class="fileName" href="http://t2.qpic.cn/mblogpic/4b7b0f97696354602c26/2000">截屏.jpg</a></span><a class="del" href="javascript:;">[删除]</a></span><div style="margin:3px 0px 8px;padding:4px;border:1px solid #E5E5E5;background-color:#fff;position:absolute;z-index:20;top:15px;left:0;box-shadow:1px 1px 3px #999;" class="big"><div style="width:112px;line-height:1.231;height:19px;" class="loading">处理中...</div><div style="clear:both;text-align:center;_width:160px;display: none;" class="imgct"><img><br><div style="display:inline;white-space:nowrap;"></div></div></div></div></div><p><a class="ffsong addBrief" href="javascript:;">+添加投票说明</a></p></dd></dl><dl style="display:none" class="voteAddTr clear"><dt></dt><dd><textarea name="brief" id="brief" class="inputTxt"></textarea><span class="voteAddError"></span></dd></dl><dl class="voteAddTr clear"><dt>投票选项:</dt><dd><ul class="wordVote clear" id="wordVote"><li><span class="index">1.</span><input type="text" value="" class="inputTxt" id="opttitle" name="opttitle"><a class="del" href="javascript:;" style="display:none">[删除]</a><span class="voteAddError error" ></span></li><li><span class="index">2.</span><input type="text" value="" class="inputTxt" name="opttitle"><a class="del" href="javascript:;" style="display:none">删除</a><span class="voteAddError error"></span></li></ul><form id="uploadOptPicForm" class="sPicForm" enctype="multipart/form-data" method="post" target="voteAddIframe" action="http://upload.t.qq.com/asyn/uploadpic.php"><ul style="display:none;" id="picVote" class="picVote clear"><li><span class="index">1.</span><a class="btn_addPic" href="javascript:void(0);"><span class="js_picupload"><em>+</em>加图片</span><input type="file" class="filePrew" name="" size="3" title="支持jpg、jpeg、gif、png格式，文件小于5M" tabindex="3"><span class="js_picuploading"  style="display:none;"><div class="vote_up_pic uploading"></div>上传中</span><span class="js_picloaded" style="display:none"><img src="about:blank"><span class="votepicbg"></span><p>更改图片</p></span><input type="text" style="display:none" id="optpic" class="optpic"></a><input type="text" name="opttitle" id="opttitle" class="inputTxt" value=""><a href="javascript:;" class="del"style="display:none">[删除]</a><span class="voteAddError error"></span></li><li><span class="index">2.</span><a class="btn_addPic" href="javascript:void(0);"><span class="js_picupload"><em>+</em>加图片</span><input type="file" class="filePrew" name="" size="3" title="支持jpg、jpeg、gif、png格式，文件小于5M" tabindex="3"><span class="js_picuploading"  style="display:none;"><div class="vote_up_pic uploading"></div>上传中</span><span class="js_picloaded" style="display:none"><img  src="about:blank;"><span class="votepicbg"></span><p>更改图片</p></span><input type="text" style="display:none"  class="optpic"></a><input type="text" name="opttitle"  class="inputTxt" value=""><a href="javascript:;" class="del"style="display:none">[删除]</a><span class="voteAddError error"></span></li></ul></form><p class="pl10 ml10"><a class="voteAddOption ffsong" href="#">+增加选项</a></p></dd></dl><dl class="voteAddTr clear"><dt>投票方式:</dt><dd><label><input type="radio" checked="" value="1"  name="ftype" id="ftype" class="check1"><b style="display:none" class="pass"></b>单选</label><label class="pl10 pr5"><input type="radio" value="" name="ftype" class="check1">多选</label><select class="mostoption" id="ftype_select" style="visibility:hidden;"><option value="0">任意</option></select><span class="voteAddError error" style="display:none"></span></dd></dl></div><div class="viewresult voteAddTr"><label><input type="checkbox" id="status" name="status" class="left"><span class="pl5">投票后可见结果</span></label><span class="voteAddError error"></span></div><div class="endtime voteAddTr"><label><input type="checkbox" name="end_time" id="end_time" class="endtimeinput"><span class="pl5 pr10">截止日期</span></label><select id="end_time_select"><option value="0">自定义</option><option value="d" selected="selected">一天</option><option value="w">一周</option><option value="m">一月</option></select><span style="display:none"><input type="text" value="" class="date_ymd" id="js_calendar">',"<div class=\"calendar\" onclick=\"UI.DatePicker.show(event,{format:'yyyy-MM-dd',target:$('js_calendar'),startDay:'"+UI.formatDate(new Date,"yyyy-MM-dd")+"'});return false;\">",'<em class="ico_cale"></em><b class="a a_t a3"></b></div><select tabindex="8" id="js_hour" name=""><option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option></select>时<select tabindex="8" id="js_min" name=""><option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option><option value="24">24</option><option value="25">25</option><option value="26">26</option><option value="27">27</option><option value="28">28</option><option value="29">29</option><option value="30">30</option><option value="31">31</option><option value="32">32</option><option value="33">33</option><option value="34">34</option><option value="35">35</option><option value="36">36</option><option value="37">37</option><option value="38">38</option><option value="39">39</option><option value="40">40</option><option value="41">41</option><option value="42">42</option><option value="43">43</option><option value="44">44</option><option value="45">45</option><option value="46">46</option><option value="47">47</option><option value="48">48</option><option value="49">49</option><option value="50">50</option><option value="51">51</option><option value="52">52</option><option value="53">53</option><option value="54">54</option><option value="55">55</option><option value="56">56</option><option value="57">57</option><option value="58">58</option><option value="59">59</option></select> 分</span><span class="voteAddError error"></span></div><div class="left mt10 pt10 pb10"><label class="gb_btn gb_btn1"><button class="t" type="button">完成填写</button></label><span class="cNote pl5">还需点击广播按钮才能发布</span></div>','<form method="post" target="voteAddIframe" id="voteAddFrom" name="voteAddFrom"  action="'+MI.url.newvote+'"></form>','<p style="display:none" class="cError"></p></div>'].join("");this.voteDom=UI.html(d)[0];d=e(a._box,".voteDiv")[0];UI.append(this.voteDom,d);a._voteForm=f("voteAddFrom");a._voteOptions=f("wordVote");a._votePicOptions=f("picVote");a._voteAddOption=e(a._box,".voteAddOption")[0];a._addBrief=e(a._box,"a.addBrief")[0];a._voteAddOption.onclick=function(){UI.hasClass(a._tab[0],"select")?30<=e(this.parentNode.parentNode,"ul#wordVote li").length&&UI.hide(this):31<=e(this.parentNode.parentNode,"ul#picVote li").length&&UI.hide(this);c.newAddVoteOption(a);return!1};c.delVoteOptionEvt(a);a._addBrief.onclick=function(){var a=f("brief"),b=a.parentNode.parentNode;a.value="";UI.toggle(b);this.innerHTML=this.innerHTML=="+"+_("添加投票说明")?"-"+_("不需要说明了"):"+"+_("添加投票说明");e(b,".voteAddError")[0].innerHTML="";try{a.focus()}catch(c){}return!1};e(a._box,".voteDiv button.t")[0].onclick=function(a){c.upVote._tab[0]&&UI.hasClass(c.upVote._tab[0],"select")?(MI.Bos("newVoteBtnWord"),c.voteLastPage=0):(MI.Bos("newVoteBtnPic"),c.voteLastPage=1);f("voteDiv").onsubmit(a);return!1};var h=document.getElementsByName("ftype"),m=f("ftype_select");m.onchange=function(){h[1].value=m.value};m.onchange();h[1].parentNode.onclick=h[0].parentNode.onclick=function(){m.style.visibility=h[0].checked?"hidden":""};var i=f("js_calendar");f("end_time_select").onchange=function(){var a=this.value,b=new Date;0==a?UI.show(i.parentNode):UI.hide(i.parentNode);"d"==a&&(b.setDate(b.getDate()+1),i.value=UI.formatDate(b,"yyyy-MM-dd"));"w"==a&&(b.setDate(b.getDate()+7),i.value=UI.formatDate(b,"yyyy-MM-dd"));"m"==a&&(b.setMonth(b.getMonth()+1),i.value=UI.formatDate(b,"yyyy-MM-dd"))};i.value=UI.formatDate(b,"yyyy-MM-dd");f("js_hour").value=b.getHours();b=b.getMinutes();10>b&&(b="0"+b);f("js_min").value=b;var n=f("uploadTitlePic"),j=f("uploadTitlePicForm"),o=e(a._box,".sendStatus")[0],l=e(a._box,".fileName")[0],k=e(a._box,".sendStatus div.loading")[0],g=e(a._box,".imgct")[0],p=e(a._box,".preview")[0],q=e(g,"img")[0],r=e(p,".del")[0],s;p.onmouseover=function(){UI.show(k.parentNode)};p.onmouseout=function(){UI.hide(k.parentNode)};r.onclick=function(){o.style.display="none";o.style.visibility="hidden";p.style.display="none";l.innerHTML="";UI.show(k);UI.hide(g);n.disabled=!1;j.reset();f("url").value="";UI.B.chrome&&(j.innerHTML=j.innerHTML,n=f("uploadTitlePic"),n.onchange=s);if(UI.B.ie6){var a=l.parentNode.parentNode;UI.remove(l.parentNode);UI.append(l.parentNode,a);UI.append(r,a)}return!1};c.votePicUploadFun=[];c.votePicUploading=!1;n.onchange=s=function(){if(this.disabled)return!1;var a=this.value.toLowerCase();if(!/\.(png|jpg|jpeg|gif)$/.test(a))return MI.alert(_("仅支持jpg、jpeg、gif、png图片文件")),!1;o.style.display="block";o.style.visibility="";k.parentNode.style.top="0px";k.parentNode.style.display="";if(c.votePicUploading)return c.votePicUploadFun.push({fun:arguments.callee,args:this}),!1;c.votePicUploading=!0;MI.TalkBox.cur.addPic=function(b){if(0==b.result){n.disabled=!0;k.parentNode.style.top="15px";UI.hide(k);UI.show(g);UI.show(p);var d=a.lastIndexOf("\\");a=a.substr(d+1);l.innerHTML=a;UI.hide(k.parentNode);q.onload=function(){UI.show(k.parentNode);setTimeout(function(){UI.hide(k.parentNode)},2E3)};q.src=b.info.image+"/160";f("url").value=b.info.image}c.votePicUploading=!1;setTimeout(function(){var a=c.votePicUploadFun.shift();a&&a.fun.call(a.args)},100)};j.submit()};b=e(a._box,".picVote .btn_addPic");UI.each(b,function(a){c.bindPicVoteUpPicEvt(a)})};MI.TalkBox.prototype.bindPicVoteUpPicEvt=function(a){var b=this,c=e(a,"input")[0],d=f("uploadOptPicForm"),h=e(a,".js_picupload")[0],m=e(a,".js_picuploading")[0],i=e(a,".js_picloaded")[0],n=e(a,".optpic")[0],j=e(a,"img")[0];c.onchange=function(){if(this.disabled)return!1;var a=this.value.toLowerCase();if(!/\.(png|jpg|jpeg|gif)$/.test(a))return a&&MI.alert(_("仅支持jpg、jpeg、gif、png图片文件")),!1;UI.hide(i);UI.hide(h);UI.show(m);if(b.votePicUploading)return b.votePicUploadFun.push({fun:arguments.callee,args:this}),!1;c.name="pic";b.votePicUploading=!0;MI.TalkBox.cur.addPic=function(a){c.name="";0==a.result&&(UI.hide(m),UI.show(i),j.src=a.info.image+"/60",n.value=a.info.image,UI.fireEvent(f("opttitle"),"blur"));b.votePicUploading=!1;setTimeout(function(){var a=b.votePicUploadFun.shift();a&&a.fun.call(a.args)},100)};d.submit()}};MI.TalkBox.prototype.delVoteOptionEvt=function(a){function b(){UI.each(d,function(b){b.onclick=function(){var d=c.voteOptionData(a),i,n;i=UI.hasClass(a._tab[0],"select")?UI.parents(b,"wordVote")[0]:UI.parents(b,"picVote")[0];n=b.parentNode;i=e(i,"li");var j;UI.each(i,function(a,b){a==n&&(j=b)});d.splice(j,1);UI.remove(i[i.length-1]);c.voteOptionData(a,d);c.checkVoteOptionDelBtn(a);UI.fireEvent(f("opttitle"),"blur");return!1}})}var c=this,d;d=e("#wordVote .del");b();c.checkVoteOptionDelBtn(a);d=e("#picVote .del");b();c.checkVoteOptionDelBtn(a)};MI.TalkBox.prototype.voteOptionData=function(a,b){var c=b||[],d=!b?1:0;UI.hasClass(a._tab[0],"select")?UI.each(e(a._voteOptions,"li input.inputTxt"),function(a,b){d?c.push({w:a.value}):a.value=c[b].w}):(UI.each(e(a._votePicOptions,"li input.inputTxt"),function(a,b){d?c.push({p:a.value}):a.value=c[b].p}),UI.each(e(a._votePicOptions,"li input.optpic"),function(a,b){d?c[b].pic=a.value:a.value=c[b].pic}),UI.each(e(a._votePicOptions,"li .js_picloaded img"),function(a,b){d?c[b].src=UI.A(a,"src"):UI.A(a,"src",c[b].src)}));if(d)return c};MI.TalkBox.prototype.checkVoteOptionDelBtn=function(a){var a=UI.hasClass(a._tab[0],"select")?e(a._box,"ul#wordVote li .del"):e(a._box,"ul#picVote li .del"),b=a.length;UI.each(a,function(a){2>=b?UI.hide(a):UI.show(a)})};MI.TalkBox.prototype.checkVoteOptionIndex=function(a){if(a=UI.hasClass(a._tab[0],"select")?e(a._box,"ul#wordVote li .index"):e(a._box,"ul#picVote li .index"))for(var b=0,c=a.length;b<c;b++)a[b].innerHTML=b+1+"."};MI.TalkBox.prototype.newAddVoteOption=function(a){if(UI.hasClass(a._tab[0],"select")){var b=this,c=UI.html('<li><span class="index"></span><input type="text" name="opttitle" class="inputTxt"><b style="display:none" class="pass"></b><a style="" href="javascript:;" class="del">[删除]</a><span class="voteAddError error"></span></li><li><span class="index"></span><input type="text" name="opttitle" class="inputTxt"><b style="display:none" class="pass"></b><a style="" href="javascript:;" class="del">[删除]</a><span class="voteAddError error"></span></li>'),d=document.createDocumentFragment();UI.each(c,function(a){UI.append(a,d)});UI.append(d,a._voteOptions)}else b=this,c=UI.html('<li><span class="index">1</span><a class="btn_addPic" href="javascript:void(0);"><span class="js_picupload"><em>+</em>加图片</span><input type="file" class="filePrew" size="3" title="支持jpg、jpeg、gif、png格式，文件小于5M" tabindex="3"><span class="js_picuploading" style="display:none"><div class="vote_up_pic uploading"></div>上传中</span><span class="js_picloaded" style="display:none"><img  src="about:blank;"><span class="votepicbg"></span><p>更改图片</p></span><input type="text" style="display:none" class="optpic"></a><input type="text" name="opttitle" class="inputTxt" value=""><a href="#" class="del"style="">[删除]</a><span class="voteAddError error"></span></li>')[0],UI.append(c,a._votePicOptions),b.bindPicVoteUpPicEvt(e(c,".btn_addPic")[0]);b.checkVoteOptionIndex(a);b.delVoteOptionEvt(a);var h=f("opttitle"),a=document.getElementsByName("opttitle");UI.each(a,function(a){"opttitle"!=a.id&&(a.onfocus=a.onblur=function(){UI.fireEvent(h,"blur");e("#picVote .voteAddError")[0].innerHTML="";e("#wordVote .voteAddError")[0].innerHTML=""})});UI.each(e("#wordVote .inputTxt"),function(a){MI.TalkBox.prototype.voteInputTip(a,e(a.parentNode,".voteAddError")[0],35,1)});UI.each(e("#picVote .inputTxt"),function(a){MI.TalkBox.prototype.voteInputTip(a,e(a.parentNode,".voteAddError")[0],20,1)})};MI.TalkBox.prototype.resetVote2=function(a){UI.show(a._voteAddOption);var b=e(a._voteOptions,"input");UI.each(b,function(a,b){3<b?UI.remove(a.parentNode):a.value=""});var b=e(f("picVote"),"input.inputTxt"),c=e(f("picVote"),".optpic"),d=e(f("pivVote"),".js_picupload"),h=e(f("pivVote"),".js_picloaded");UI.each(b,function(a,b){3<b?UI.remove(a.parentNode):(a.value="",c[b].value="",UI.show(d[b]),UI.hide(h[b]))});e(a._box,".sendStatus .del")[0].onclick();f("sbjtitle").value="";f("brief").value="";UI.hide(f("brief").parentNode.parentNode);f("ftype").checked=!0;a._addBrief.innerHTML="+"+_("添加投票说明");if(UI.B.ie){var m=f("picVote");pa=m.parentNode;UI.remove(m);setTimeout(function(){UI.append(m,pa)},10)}};MI.TalkBox.prototype._resetRtPic=function(a){if(this._retweetPic&&this._retweetPic.used){var b,c=this._rtPicWrap,d=this._rtPicForm,e=UI.G("retweetPic");(b=this.$(".insertFun .uploadPicLoader"))&&UI.remove(b);(b=this.$(".insertFun .uploadPicSuccess"))&&UI.remove(b);e&&(e.src="about:blank");d.reset();UI.B.chrome&&(b=this._retweetPic.onchange,d.innerHTML=d.innerHTML,this._retweetPic=UI.GT(d,"input")[0],this._rtPicAnchor=UI.GC(d,".txt")[0],this._retweetPic.onchange=b);this._retweetPic.disabled=!1;this._retweetPic.used=!1;UI.show(c)}var m=this;(a=f(a))&&UI.A(a,"wqid")&&setTimeout(function(){m._rtPicWrap&&UI.hide(m._rtPicWrap)},100)};var J=MI.TalkBox.prototype,v,w,D=null,E="",z=null,A,r,u,B=function(a){var b=document.createElement("div"),a=document.createTextNode(a);b.appendChild(a);return b.innerHTML},F=function(a){var b=["<dt>选择专题类别</dt>"],c,d,h=[],f=e(this._microTpcCtn.firstChild,".page")[0];c=Math.ceil(v.length/6);if(a>c||1>a)a=1;UI.each(v,function(c,d){d>=6*(a-1)&&d<6*a&&b.push('<dd><a data-id="'+c.id+'" class="tpc-cate" href=#>'+B(c.categoryName)+"</a></dd>")});0===v.length&&b.push("<dd>暂无分类</dd>");e(this._microTpcCtn.firstChild,"dl")[0].innerHTML=b.join("");for(d=1;d<=c;d++)d===a?h.push("<b>"+d+"</b>"):h.push('<a href="#" class="tpc-page">'+d+"</a>"),h.push("&nbsp;");f.innerHTML=h.join("");1<c?UI.show(f):UI.hide(f);this._microTpcCtn.firstChild.style.cssText=u;UI.hide(this._microTpcCtn.childNodes[1]);UI.hide(this._microTpcCtn.childNodes[2]);UI.show(this._microTpcCtn)},G=function(a){var b=this;MI.ajax({url:MI.url.micrTpcList,type:"get",data:{cid:D,ps:6,p:a,_r:UI.random()},success:function(c){var d=[],h,f,i=[];if((c=MI.json(c))&&0===c.result){UI.hide(b._microTpcCtn.firstChild);e(b._microTpcCtn.childNodes[1],".top span")[0].innerHTML=E;0<c.info.topicCount?(w={},UI.each(c.info.topic,function(a){d.push('<dd><a href="#" data-tid="'+a.id+'" class="tpc-tpc">'+B(a.topicName)+"</a></dd>");w[a.id]=a})):d.push('<dd style="padding:10px 5px">暂无专题</dd>');h=Math.ceil(c.info.topicTotal/6);f=e(b._microTpcCtn.childNodes[1],".page")[0];if(1<h){for(c=1;c<=h;c++)c===a?i.push("<b>"+c+"</b>"):i.push('<a href="#" class="tpc-page2">'+c+"</a>"),i.push("&nbsp;");f.innerHTML=i.join("");UI.show(f)}else UI.hide(f);e(b._microTpcCtn.childNodes[1],"dl")[0].innerHTML=d.join("");b._microTpcCtn.childNodes[1].style.cssText=u}else MI.alert(c&&c.msg||_("服务器繁忙，请稍后重试"))}})},K=function(a){var b=[],c,d;d=this._microTpcCtn.childNodes[2];UI.hide(this._microTpcCtn.childNodes[1]);e(d,".top span")[0].innerHTML=a;a=w[z].subField;for(c in a)a.hasOwnProperty(c)&&b.push('<dd><a href="#" data-sid="'+c+'" class="tpc-sub">'+B(a[c].subFieldName)+"</a></dd>");e(d,"dl")[0].innerHTML=b.join("");d.style.cssText=u},H=function(a,b,c){a={cid:z,tid:a,ts:b,_r:UI.random()};c&&(a.colid=c);MI.ajax({url:MI.url.micrTpcCollect,type:"get",data:a,success:function(a){(a=MI.json(a))&&a.result===0?MI.tip(_("采集成功")):MI.alert(a&&a.msg||_("服务器繁忙，请稍后重试"))}})},L=function(a,b){var c=this,d;UI.each(UI.GC(c._sendStatus,".uploadMtpc"),function(a){UI.remove(a)});d=UI.html('<div class="sendThumbs uploadMtpc"><span class="preview"><span class="link"><a href="javascript:void(0);" class="fileName" style="position:relative;">'+b+'</a></span><a href="#" class="del" title="删除">[删除]</a></span></div>')[0];UI.append(d,c._sendStatus);UI.GC(d,".del")[0].onclick=function(){I(c)};UI.hasClass(c._sendCnt,"hasMedia")||UI.addClass(c._sendCnt,"hasMedia");c.microTpcId=a},I=function(a){2>UI.children(a._sendStatus,"sendThumbs").length&&UI.removeClass(a._sendCnt,"hasMedia");UI.each(UI.GC(a._sendStatus,".uploadMtpc"),function(a){UI.remove(a)});a.microTpcId=null},M=function(a){var b,c,d,h=this,f=function(){h._microTpcCtn&&(UI.remove(h._microTpcCtn),UI.removeClass(d,"mFunDis_o"),UI.ER(document.body,"click",f),h._microTpcCtn=null)};u="display:block;"+(r?"":"top:-80px");c=UI.html('<div><div class="collect_pn"><div class="s1"><dl></dl><div class="page"></div></div></div><div class="collect_pn" style="display:none"><div class="s1"><div class="top"><a href="#" class="tpc-back">&lt;返回</a> | <span></span></div><dl></dl><div class="page"></div></div></div><div class="collect_pn" style="display:none"><div class="s1"><div class="top"><a href="#" class="tpc-back2">&lt;返回</a> | <span></span></div><dl></dl></div></div></div>')[0];d=r?e(a,".mFun")[0]:e(h._moreDropBox,".micoZt")[0];d.appendChild(c);h._microTpcCtn=c;b={page:function(a){a=parseInt(a.innerHTML,10);isNaN(a)||F.call(h,a)},page2:function(a){a=parseInt(a.innerHTML,10);isNaN(a)||G.call(h,a)},cate:function(a){var b=UI.A(a,"data-id");b&&(D=b,E=a.innerHTML,G.call(h,1))},back:function(){UI.hide(h._microTpcCtn.childNodes[1]);h._microTpcCtn.firstChild.style.cssText=u},back2:function(){UI.hide(h._microTpcCtn.childNodes[2]);h._microTpcCtn.childNodes[1].style.cssText=u},tpc:function(b){var c=UI.A(b,"data-tid");r?w[c]&&0<w[c].subFieldNum?(z=c,K.call(h,b.innerHTML)):(H(a.id,UI.A(a,"rel")),f()):(L.call(h,c,b.innerHTML),UI.hide(h._microTpcCtn))},sub:function(b){b=UI.A(b,"data-sid");a.id.match(/([0-9]{5,})($|\D)/);H(a.id,UI.A(a,"rel"),b);f()}};UI.EA(h._microTpcCtn,"click",function(a){for(var a=UI.E(a),c=a.target,d;c&&c!==h._microTpcCtn;){if((d=(d=c.className)&&d.split("-"))&&"tpc"===d[0]&&b[d[1]]){b[d[1]](c,a);a.prevent();a.stop();break}c=c.parentNode}});r&&(UI.addClass(d,"mFunDis_o"),UI.EA(document.body,"click",f))};A=function(a){var b=this;r=!!a;MI.ajax({url:MI.url.micrTpcCate,type:"get",data:{_r:UI.random()},success:function(c){if((c=MI.json(c))&&0===c.result){v=c.info.category;if(r||!b._micoTpcInited)M.call(b,a),r||(b._micoTpcInited=1);F.call(b,1)}else MI.alert(c&&c.msg||_("服务器繁忙，请稍后重试"))}})};A.clear=I;J.microTpc=A;MI.SearchPic={talkBox:null,builded:!1,_tUrl:!1,_pSearch:null,_pSearchPage:null,_segword:"",_radioValue:"0",_preRadioValue:"0",_isPageClick:0,_pageNow:0,build:function(a){var b=this;if(!UI.A(a._searchPicBox,"builded")){this.PageNum=16;b.talkBox=a;var c=UI.html('<div class="loading" style="display:none;"></div><div class="p_searchBox clear"><span class="sosoLogo"><em class="ico_soso"></em>图片</span><form method="get"><div class="m_searchBox clear"><span class="m_item1"><input type="text" class="inputTxt"></span><span class="m_item2"><label class="gb_btn gb_btn1"><input type="button" class="t btn1" value="搜索"></label></span></div><p class="p_searchSel"><label><input type="radio" class="check1" name="picClass" value="0">表情图片</label><label><input type="radio" class="check1" name="picClass" value="1">普通图片</label></p></form></div>'),d=document.createDocumentFragment();UI.each(c,function(a){UI.append(a,d)});UI.prepend(d,a._searchPicBox);a._picSearchKey=e(a._searchPicBox,".inputTxt")[0];a._picSearchBtn=e(a._searchPicBox,".btn1")[0];a._picSearchFrom=e(a._searchPicBox,"form")[0];b._sLoading=e(a._searchPicBox,".loading")[0];a._radioInput=e(a._searchPicBox,".p_searchSel label");b._picSearchKey=a._picSearchKey;e(a._radioInput[0],".check1")[0].checked=!0;var h=document.getElementsByName("picClass");UI.each(h,function(a){!0==a.checked&&(b._preRadioValue=b._radioValue=a.value)});UI.show(b._sLoading);UI.getScript("http://cache.soso.com/js/an-app.js",function(){});a._radioInput[0].onmousedown=a._radioInput[1].onmousedown=a._picSearchBtn.onclick=a._picSearchFrom.onsubmit=function(c){c=UI.E(c).target;"label"==c.nodeName.toLowerCase()||"check1"==c.className?(b._preRadioValue=b._radioValue,b._radioValue="label"==c.nodeName.toLowerCase()?UI.A(e(c,".check1")[0],"value"):UI.A(c,"value"),MI.Bos("BtnSearchClass_"+b._radioValue)):h&&UI.each(h,function(a,c){!0==a.checked&&(b._preRadioValue=b._radioValue,b._radioValue=a.value,MI.Bos("BtnSearchClass_"+c))});b.searchPic(a._picSearchKey.value,0,b._radioValue);window.__sosostat&&window.__sosostat.prget&&__sosostat.prget(document.location.href,"t.1.1.0",0,"bq_app");MI.Bos("btnPicSearchGo");return!1};b.searchPic("",0);UI.hide(b._sLoading);UI.A(a._searchPicBox,"builded",1);MI.focus(a._picSearchKey)}},tmpl:'<div class="p_sResult"><%if(errCode == 0){%>\t<%var allnum = general.allnum,segword = general.segword;%>\t<%if(items.length > 0){%><div class="p_sList">\t<ul class="clear"><%for(var i=0,n=items.length;i<n;i++){%>\t<%var px,\tpicid = items[i].MD,\tSrc = items[i].SRC,\tsSrc = items[i].SSRC,\ttit = items[i].TI || "";%>\t<%if(i%8 > 3){px="4px"}else{px ="";}%>\t<li><a href="<%=Src%>" rel="<%=px%>" onclick="return false;"><img id="<%=picid%>" src="<%=sSrc%>" alt="<%=tit%>" title="<%=tit%>" /></a></li><%}%>\t</ul></div><%if(segword){%>\t<p class="p_sNum">'+_("搜索到")+'<b><%=allnum%></b>个和<span class="cSign"><%=segword%></span>'+_("相关的图片")+"</p><%}%>\t<%}%><%}%>\t</div>",show:function(){},searchPic:function(a,b,c,d){function e(){window.jsonSoSoPic&&("0"==f._radioValue?f.searchPicCallBack(jsonSoSoPic.sosovdap.expression):"1"==f._radioValue&&f.searchPicCallBack(jsonSoSoPic.sosovdap.image))}var f=this,b=0<parseInt(b)?parseInt(b):0;"1"==c&&""==a&&(a="风景");a=MI.string.html(a);f._Key=a;f._isPageClick=null!=d&&1==d?1:0;d="http://vdap.soso.com/service";a=["src=37&ie=utf8&mark=MD|SRC|SSRC|TI&ofmt=json&nu=16","w="+UI.encode(a),"sn="+b,"r="+MI.random(),"var=jsonSoSoPic"];d=d+("?"+(null!=c?"1"==c?"kd=i&ity=1&size=1":"kd=e&ng=on":"kd=e&ng=on"))+("&"+a.join("&"));a=MI.url.uploadSearchPic+"?p="+b+"&var=jsonSoSoPic&r="+MI.random();b=d;!c||"0"==c?(b=a,f._tUrl=1):(b=d,f._tUrl=0);f._tUrl?MI.ajax({url:b,success:function(a){try{eval(a)}catch(b){}e()}}):UI.getScript(b,function(){e()},"gb2312")},searchPicCallBack:function(a){var b=this;if(a&&0==a.errCode){var c;UI.hide(b._sLoading);a.general&&!a.general.segword&&(a.general.segword="");b._noResult&&UI.remove(b._noResult);b._pSearch=e(b.talkBox._searchPicBox,".p_sResult")[0];UI.show(b._pSearch);b.talkBox._pSearchPage||(c=UI.html('<div class="pages"></div>')[0],UI.append(c,b._pSearch),b.talkBox._pSearchPage=new MI.Page({target:c,num:2,call:function(a){b.searchPic(b._Key,b._tUrl?a:(a-1)*16,b._radioValue,1)}}),c=Math.ceil(a.general.allnum/b.PageNum),b._pageNow=999<c?999:c,b.talkBox._pSearchPage.show(0,b._pageNow,!1),b._segword=b._Key);b.searchPage(a);if((0!=a.errCode||a.general.allnum<b.PageNum)&&b.talkBox._pSearchPage&&b.talkBox._pSearchPage.target)UI.remove(b.talkBox._pSearchPage.target),b.talkBox._pSearchPage=null;b._pSearch&&!b.p_Preview&&(a=UI.html('<div class="picPreview" style="visibility:hidden;"><img style="max-width:97px;max-height:97px;" src="http://mat1.gtimg.com/www/mb/images/loading.gif" alt=""></div>')[0],UI.append(a,b._pSearch),b.p_Preview=a,b.p_img=e(a,"img")[0])}else a&&0!=a.errCode&&(UI.hide(b._sLoading),b._pSearch&&UI.hide(b._pSearch),b._noResult&&UI.remove(b._noResult),a=UI.html('<div class="p_noResult"><p>'+_("对不起，未找到")+'<b>"'+b._Key+'"</b>'+_("的相关图片。")+"</p><p>"+_("请检查关键词是否正确，或更换其他关键字搜索。")+"</p></div>")[0],UI.append(a,b.talkBox._searchPicBox),b._noResult=a)},searchPage:function(a){if(a&&0==a.errCode){var b=UI.html((new UI.tmplString(this.tmpl))(a)),c=document.createDocumentFragment();UI.each(UI.children(b[0]),function(a){UI.isElement&&UI.append(a,c)});var b=e(this._pSearch,".p_sNum")[0],d=e(this._pSearch,".p_sList")[0],h=e(this._pSearch,".p_noResult")[0],f=e(this._pSearch,".pages")[0];b&&UI.remove(b);d&&UI.remove(d);h&&UI.remove(h);if(f&&!this._isPageClick&&(this._preRadioValue!=this._radioValue||UI.trim(this._segword)!=UI.trim(this._Key)))a=Math.ceil(a.general.allnum/this.PageNum),this._pageNow=999<a?999:a,this.talkBox._pSearchPage.show(0,this._pageNow,!1),this._segword=UI.trim(this._Key);UI.prepend(c,this._pSearch);if(this.m_total=e(this._pSearch,".p_sNum")[0])(this.cSign=e(this.m_total,".cSign")[0])&&(this.cSign.innerHTML=UI.trim(MI.string.cut(this._Key,16)));999==this._pageNow&&(e(this._pSearch,".p_sNum b")[0].innerHTML=16*this._pageNow);this.bindEvent(e(this._pSearch,".p_sList")[0]);""==this._picSearchKey.value?UI.hide(this.m_total):UI.show(this.m_total)}},bindEvent:function(a){if(a){var b=this;if("1"==b._radioValue){var c=e(a,"li img");UI.each(c,function(a){a.style.width="48px"})}a.onmouseover=function(a){var c=UI.E(a);"IMG"==c.target.nodeName?setTimeout(function(){b.p_img.src="1"==b._radioValue?c.target.src:UI.parent(c.target).href;b.p_Preview.style.left=UI.parent(c.target).rel;b.p_Preview.style.visibility="visible"},10):setTimeout(function(){b.p_Preview.style.visibility="hidden"},10);c.stop()};a.onmouseout=function(a){a=UI.E(a);"IMG"==a.target.nodeName&&setTimeout(function(){b.p_Preview.style.visibility="hidden";UI.A(b.p_img,"load",0)},10);a.stop()};a.onclick=function(a){a=UI.E(a);"IMG"==a.target.nodeName&&(b.talkBox.hideMedia(),UI.append(b.talkBox._uploadPicS,b.talkBox._sendStatus),!UI.hasClass(b.talkBox._sendCnt,"hasMedia")&&UI.addClass(b.talkBox._sendCnt,"hasMedia"),UI.addClass(b.talkBox._picLoading,"loading"),UI.show(b.talkBox._picLoading),MI.ajax({url:MI.url.uploadUrlPic,type:"get",data:"sourcepic="+encodeURIComponent(UI.parent(a.target).href),success:function(a){a=MI.json(a);0==a.result&&a.info?b.talkBox.addPic({result:0,msg:_("上传成功"),info:{image:a.info.image,fileName:_("搜图.jpg")}}):(-7==a.result&&MI.talkBox.delPic(),MI.dialog.alert(a.msg||_("图片上传失败，请重试")))}}),window.__sosostat&&window.__sosostat.prget&&__sosostat.prget(document.location.href,"t.2.2."+a.target.id,0,"bq_app"),MI.Bos("btnPicSearchUse"));a.stop();return!1}}}};MI.PhotoMultiUpload={html:"",sendBtn:null,cancelBtn:null,uploadUrl:"",build:function(a,b){var c=this;c.html=MI.Flash.getObject(null,MI.swf.PingtuEditor,462,165,"MultiPhoto");if(10.3>MI.Flash.getVersion())a.innerHTML=MI.Flash.updateTip(10.3);else if(c.uploadUrl=b||"http://upload.t.qq.com",c.builded)UI.C(c.loading,"opacity",1),UI.show(c.loading),c.show(),UI.B.ie6&&c.resizeLoading();else return c.target=a,c.sendBtn=e(a,".btnSend")[0],c.cancelBtn=e(a,".btnCancel")[0],c.flashWrap=e(a,".flashWrap")[0],c.loading=e(a,".maskLoading")[0],c.captureBtn=e(a,".capture")[0],c.tip=e(a,".error")[0],c.flashWrap.innerHTML=c.html,c.sendBtn.onclick=function(){MI.TalkBox.cur.multiPicClick=1;c.upload()},c.cancelBtn.onclick=c.hide,window._flash_resizeFlashHeight=function(a){c.resetSize(a)},window._flash_multiUploadCall=function(a){c.uploadCall(a)},window._flash_setMultiTip=function(a){c.setTip(a)},window._flash_MultiLoaded=function(){c.show()},!1},show:function(){document.MultiPhoto&&document.MultiPhoto.multiPic_startSave&&(UI.hide(this.loading),UI.C(this.loading,"opacity",0.5))},hide:function(){MI.TalkBox.cur.upPic.hide()},capture:function(){this.captureBtn&&UI.fireEvent(this.captureBtn,"click")},captureImg:function(a){document.MultiPhoto&&document.MultiPhoto.multiPic_captureImg(a)},upload:function(){UI.B.ie6&&this.resizeLoading();UI.show(this.loading);document.MultiPhoto.multiPic_startSave(this.uploadUrl,"_flash_multiUploadCall");MI.Bos("btnPhotoMultiSend")},clear:function(){document.MultiPhoto&&document.MultiPhoto.multiPic_clearStage&&document.MultiPhoto.multiPic_clearStage();UI.hide(this.loading)},resetSize:function(a){this.setTip("");document.MultiPhoto&&(document.MultiPhoto.height=1*a);a=UI.getY(this.flashWrap)+a+100-UI.windowHeight();(0<=a||225<UI.scrollY())&&window.scrollTo(0,a)},resizeLoading:function(){UI.C(this.loading,"height",UI.height(this.target))},uploadCall:function(a){UI.hide(this.loading);a=MI.json(a);0==a.result?(MI.TalkBox.cur.upPic.hide(),this.clear(),MI.TalkBox.cur.upPic.flashCapture=0,setTimeout(function(){MI.tip(_("上传成功"),function(){MI.TalkBox.cur.addPic({result:0,msg:_("上传成功"),info:{image:a.info.image,path:a.info.path,host:a.info.host,fileName:a.info.fileName||_("多图")+".jpg"}});MI.TalkBox.cur.sendReady&&(MI.TalkBox.cur.multiPicClick=0,MI.TalkBox.cur._send(),MI.TalkBox.cur.sendReady=0)})},0)):MI.alert(a.msg)},setTip:function(a){this.tip.innerHTML=a}};MI.PhotoCameraUpload={html:"",sendBtn:null,cancelBtn:null,uploadUrl:"",build:function(a,b){var c=this;if(10>MI.Flash.getVersion())a.innerHTML=MI.Flash.updateTip(10);else if(c.html=MI.Flash.getObject(null,MI.swf.CameraPhoto,462,335,"CameraPhoto"),c.uploadUrl=b||"http://upload.t.qq.com",c.builded)UI.C(c.loading,"opacity",1),UI.show(c.loading),c.show(),UI.B.ie6&&c.resizeLoading(),UI.B.firefox&&UI.hide(c.ButtonWrap);else return c.target=a,c.sendBtn=e(a,".btnSend")[0],c.cancelBtn=e(a,".btnCancel")[0],c.flashWrap=e(a,".flashWrap")[0],c.buttonWrap=e(a,".clear")[0],c.loading=e(a,".maskLoading")[0],c.tip=e(a,".tip")[0],c.flashWrap.innerHTML=c.html,c.builded=1,c.sendBtn.onclick=function(){c.upload()},c.cancelBtn.onclick=c.hide,window._flash_resetCameraHeight=function(a){c.resetSize(a)},window._flash_cameraUploadCall=function(a){c.uploadCall(a)},window._flash_setCameraTip=function(a){c.setTip(a)},window._flash_cameraLoaded=function(a){c.show();1==a&&UI.show(c.buttonWrap)},!1},show:function(){document.CameraPhoto&&document.CameraPhoto.camera_startSave&&(UI.hide(this.loading),UI.C(this.loading,"opacity",0.5))},hide:function(){MI.TalkBox.cur.upPic.hide()},upload:function(){UI.B.ie6&&this.resizeLoading();this.setTip("");UI.show(this.loading);document.CameraPhoto.camera_startSave(this.uploadUrl,"_flash_cameraUploadCall");MI.Bos("btnPhotoCameraSend")},clear:function(){this.setTip("");document.CameraPhoto&&document.CameraPhoto.camera_clearStage&&document.CameraPhoto.camera_clearStage();this.buttonWrap&&UI.hide(this.buttonWrap);this.loading&&UI.hide(this.loading)},resetSize:function(a){this.setTip("");document.CameraPhoto&&(document.CameraPhoto.height=1*a);a=UI.getY(this.flashWrap)+a+100-UI.windowHeight();(0<=a||225<UI.scrollY())&&window.scrollTo(0,a)},resizeLoading:function(){UI.C(this.loading,"height",UI.height(this.target))},uploadCall:function(a){UI.hide(this.loading);a=MI.json(a);0==a.result?(MI.TalkBox.cur.upPic.hide(),setTimeout(function(){MI.tip(_("上传成功"),function(){MI.TalkBox.cur.addPic({result:0,msg:_("上传成功"),info:{image:a.info.image,path:a.info.path,host:a.info.host,fileName:_("拍照")+".jpg"}})})},0)):this.setTip(a.msg)},setTip:function(a){this.tip&&(this.tip.innerHTML=a)}};MI.swf.VideoRecord="http://mat1.gtimg.com/www/mb/swf/VideoRecord_111206.swf";MI.VideoRecord={html:"",uploadUrl:"",build:function(a,b){var c=this;if(10>MI.Flash.getVersion())a.innerHTML=MI.Flash.updataTip(10);else if(c.html=MI.Flash.getObject(null,MI.swf.VideoRecord,462,335,"VideoRecord"),c.uploadUrl=b||"http://upload.t.qq.com",c.builded)UI.C(c.loading,"opacity",1),UI.show(c.loading),c.show(),UI.B.ie6&&c.resizeLoading(),UI.B.firefox&&UI.hide(c.ButtonWarp);else return c.target=a,c.flashWrap=e(a,".flashWrap")[0],c.buttonWrap=e(a,".clear")[0],c.loading=e(a,".maskLoading")[0],c.tip=e(a,".tip")[0],c.flashWrap.innerHTML=c.html,c.builded=1,window.jfRecordUploadCall=function(){c.uploadCall()},window.jfRecordUploadError=function(a){c.uploadError(a)},window.jfTweet=function(a){c.tweet(a)},window.jfGetKeyFail=function(){c.getKeyFail()},window.jfRecordLoaded=function(){c.show()},window.jfGetUserAccount=function(){return MI.user.account},c.show(),!1},show:function(){document.VideoRecord&&document.VideoRecord.fjClearStage&&(UI.hide(this.loading),UI.C(this.loading,"opacity",0.5))},hide:function(){},upload:function(){},uploadCall:function(){UI.show(this.loading);MI.Bos("btnVideoRecordSend")},uploadError:function(a){MI.tip(a)},getKeyFail:function(){UI.hide(this.loading);MI.TalkBox.cur.upVideo.hide();this.clear();MI.alert("今天上传达到最大数量!")},tweet:function(a){UI.hide(this.loading);MI.TalkBox.cur.upVideo.hide();this.clear();MI.talk("视频录制成功!","#分享视频#http://v.qq.com/boke/play/"+a+".html",40,{vid:a,msg:"该微博会在转码完毕后发布，届时将会收到私信通知"})},clear:function(){document.VideoRecord&&document.VideoRecord.fjClearStage&&document.VideoRecord.fjClearStage();this.loading&&UI.hide(this.loading)}};MI.Text2Pic={html:"",theme:0,url:"http://www.qq.com/mb/mat1/mb/js/api/text2Pic_130311.html",build:function(a){var b=MI.TalkBox.cur;b.longTextModify&&1==b.longTextSource?b.delPic():e(a,"iframe")[0].src=this.url;b.longTextSource=1},confirmCancel:function(a,b){b=b||MI.TalkBox.cur;"longWBDialog"==a&&b.qmEditor.getEditor()&&b.qmEditor.getEditor().hideMenu();var c={longWBDialog:"放弃此条长微博？",upVote:"是否确定删除投票？"},d={longWBDialog:function(){b.itemSelect.resetAllData();b.itemSelect.hide();UI.fireEvent(b.itemSelect.searchInput,"blur");b.ajax&&b.ajax.abort();b.longWBDialog.hide()},upVote:function(){b.upVote.hide();b.delVote();b.resetVote2(b.upVote)}};MI.confirm({type:"error",title:a?c[a]:"确定要放弃本次编辑吗？",content:a?"":"选择“是”，本次编辑内容将无法保存",confirmTxt:"是",confirm:function(){MI.dialog.hide();if(a)d[a]();else{b.curLongTextSource==b.longTextSource?b.longTextModify=0:b.longTextSource=b.curLongTextSource||0;try{b.upPic.hide()}catch(c){}try{b.text2Pic.hide()}catch(e){}}},cancelTxt:"否"})},formTalk:function(a,b){MI.user.fun.autoTxt2Pic&&(this.useTxt2Pic||(this.useTxt2Pic=UI.html('<span class="text2PicBtn cNote right pl5">'+_("您可以")+'<a href="#" title="可发表没有字数限制的微博">'+_("转成长微博")+"</a>"+_("发表")+"</span>")[0],UI.before(this.useTxt2Pic,a._tip)),b?UI.show(this.useTxt2Pic):UI.hide(this.useTxt2Pic))}};MI.photoFilter={html:'<div class="filterPic" style="width:633px;padding:5px 0;text-align:center"><div class="flashWrap"></div><div class="clear"><p class="left" style="padding:10px 0 0 0"><a href="http://app.t.qq.com/app/intro/170278?via=170278_WB.TQQ.ADDTWEET" boss="btnPicCamera360" class="camera360 c_tx5" target="_blank"><i class="ico_camera360"></i><span>Powered by Camera360 ['+_("相机")+'360]</span></a></p><p style="text-align:right;padding:5px;" class="btnBox"><span class="error" style="padding-right:20px"></span><button class="btn3 btnSend">'+_("确定")+'</button>&nbsp;<button class="btnCancel btn_cancel">'+_("取消")+"</button></p></div></div>",flashHtml:"",body:null,sendBtn:null,cancelBtn:null,sourceUrl:"",uploadUrl:"",build:function(a,b){var c=this;if(9>MI.Flash.getVersion())MI.dialog.show({html:MI.Flash.updateTip(9)});else if(c.flashHtml=MI.Flash.getObject(null,MI.swf.SinglePhoto,630,374,"FilterPhoto"),c.sourceUrl=a,c.uploadUrl=b,c.body)c.show();else return c.body=UI.html(c.html)[0],c.sendBtn=e(c.body,".btnSend")[0],c.cancelBtn=e(c.body,".btnCancel")[0],c.tip=e(c.body,".error")[0],c.flashWrap=e(c.body,".flashWrap")[0],c.sendBtn.onclick=function(){c.upload()},c.cancelBtn.onclick=function(){c.hide()},window._flash_resetFilterSize=c.resetSize,window._flash_filterUploadCall=c.uploadCall,window._flash_setfilterTip=function(a){c.setTip(a)},c.show(),!1},show:function(){this.flashWrap.innerHTML=this.flashHtml;MI.dialog.show({title:'<h3 class="DmainTit">'+_("美化图片")+"</h3>",html:this.body,width:662});MI.dialog.showLoad();this.pushImg()},pushImg:function(){var a=this;clearTimeout(a.delay);document.FilterPhoto&&document.FilterPhoto.sendImgUrl_ToFlash?document.FilterPhoto.sendImgUrl_ToFlash(a.sourceUrl):a.delay=setTimeout(function(){a.pushImg()},100)},upload:function(){var a=this;MI.dialog.showLoad();setTimeout(function(){document.FilterPhoto.filter_upload(a.uploadUrl,"_flash_filterUploadCall")},100);MI.Bos("btnPhotoFilterSend")},hide:function(){MI.dialog.hide();UI.remove(this.body);MI.Bos("btnPhotoFilterClose")},resetSize:function(a,b){if(document.FilterPhoto){document.FilterPhoto.width=a;document.FilterPhoto.height=b;var c=e(document.body,".CR")[0];c&&window.scrollTo(0,parseInt(c.style.top)+(UI.height(c)-UI.windowHeight())/2)}},uploadCall:function(a){MI.dialog.hideLoad();a=MI.json(a);0==a.result?setTimeout(function(){MI.tip(_("上传成功"),function(){MI.TalkBox.cur.pics=[];MI.TalkBox.cur.addPic({result:0,msg:_("上传成功"),info:{image:a.info.image,path:a.info.path,host:a.info.host,fileName:_("美化")+".jpg"}})})},0):MI.alert(a.msg)},setTip:function(a){this.tip.innerHTML=a}};MI.SendGift=function(a){this.eventId=a.eventId;this.title=a.title;this.topic=a.topic;this.selectOpt=a.selectOpt;this.bodyClass=a.bodyClass||"";this.giftConfig=a.giftConfig||[];this.placeHolder=a.placeHolder||_("选择或输入好友");this.index=this.index||0;this.publishBos=a.publishBos;this.btnValue=a.btnValue;this.recordTabName=a.recordTabName;this.wordingList=a.wordingList;this.friendTitle=a.friendTitle;this.init()};MI.SendGift.prototype={atReg:/@([a-zA-Z]|[\u4e00-\u9fa5]|\*)([a-zA-Z0-9_-]|[\u4e00-\u9fa5]){0,19}/g,getHtml:function(){return'<div class="sendGiftWrap dialogTalkBox '+this.bodyClass+'"><div class="chrisBg"><p class="chrisTipTop"></p><div class="sendCnt chrisFrm clear" style="display:;"><dl><dt>'+_("送给")+'：</dt><dd><input type="text" value="'+this.placeHolder+'" class="chirsPut sendTo"></dd><dt>'+_("祝福")+'：</dt><dd><textarea class="chrisArea sendWord inputTxt"></textarea><div class="bot"><div class="sendStatus clear"></div><div class="insertFun"><div class="sendList insertFace"><a class="txt" href="#" title="'+_("表情")+'"><em class="sico ico_face"></em></a></div><div class="sendList uploadMusic"><a class="txt" href="#" title="'+_("可按歌名、歌手名搜索并添加音乐")+'" tabindex="3"><em class="sico ico_audio"></em></a></div></div><div class="left"></div><input type="button" class="inputBtn sendBtn" value="'+_("广 播")+'"><span class="countTxt">'+_("还能输入{0}字","<em>140</em>")+'</span>\t</div></dd></dl><div class="cPrizeRig"><p>'+_("选择礼物")+'：<span  class="giftName"></span></p><div class="chrisPrizeFrm" style="width:180px"><a class="cArrowLeft prev" href="#" style="margin:0;left:0;"></a><ul class="cPrizeCont giftList"></ul><a  class="cArrowRight next" href="#"></a></div><p class="cPrizeNum page"></p></div></div></div></div>'},init:function(){var a=this;a.build();a.div=[];a.talkArray=[];a.myFriendArray={};a.myFriendList=[];a.domTitle='<ul class="pr_rep_tit va_tab_re">';UI.each(a.title,function(b,c){a.domTitle+='<li class="vaTab'+(c+1)+'"><a href="#">'+b+"</a></li>"});a.domTitle+="</ul>";a.myFriend=UI.html('<div class="pr_friend_pn"><p class="pr_friend_hd">'+a.friendTitle+'</p><div class="pr_friend_bd"><div  class="loading">'+_("数据加载中")+"</div></div></div>")[0];a.div[0]=e(a.body,".chrisFrm")[0];UI.css(".anony_pn th {display:none;}.anony_pn .sendList{display:none !important;}.anony_pn .txtWrap {display:none;}");a.div[1]=UI.html('<div class="art_pn sendCnt anony_pn" style="display:none;"><p class="anonyFont">'+_("爱TA在心口难开？树洞帮你来告白！")+'</p><p class="anonyInfo">（'+_("树洞会把你的告白广播出去，勇敢@她/他，没人知道是你发的哦~详见")+'<a target="_blank" href="http://t.qq.com/k/%E6%A0%91%E6%B4%9E%E5%91%8A%E7%99%BD">#'+_("树洞告白")+"#</a>）</p>"+MI.tmpl.msgBox.replace("uploadPic","")+"</div>")[0];UI.after(a.div[1],a.div[0]);UI.after(a.myFriend,a.div[1]);a.msgBox=new MI.MsgBox(a.div[1]);a.msgBox.noRelTopic=1;a.msgBox.topic=a.topic[1];a.msgBox._msgTo.value="weiboshudong";a.msgBox._btn.value=_("扔进树洞");a.msgBox.txtMax=140-MI.countTxt(a.msgBox.topic);a.msgBox.success=function(b){a.publishSuccess(b,1)};a.talkArray[0]=a.talk;a.talkArray[0].faceHideTabIndex={3:3}},build:function(){var a=this;a.body=UI.html(a.getHtml())[0];a.sendTo=e(a.body,".sendTo")[0];a.giftBox=e(a.body,".cPrizeRig")[0];a.giftList=e(a.body,".giftList")[0];a.giftName=e(a.body,".giftName")[0];a.listHtml="";UI.each(a.giftConfig,function(b){a.listHtml+='<li><span style="background:url('+b.pic+");_background:none;_filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=crop,src='"+b.pic+"')\"></span></li>"});a.giftList.innerHTML=a.listHtml;a.talk=a.bindTalkEvent(e(a.body,".chrisFrm")[0],0,1);a.sendWord=a.talk._txt;UI.EA(a.sendWord,"focus",function(){var b=RegExp(_("#(分享音乐|分享音樂)#"));a.talk.txtMusic&&b.test(a.talk.txtMusic)&&setTimeout(function(){a.talk.txtMusic=a.talk.txtMusic.replace(b,"");a.sendWord.value&&(a.sendWord.value=a.sendWord.value.replace(b,""))},100)});UI.EA(a.sendTo,"blur",function(){a.talk.countTxt()});MI.app({ItemSelect:function(){a.select=new MI.ItemSelect(a.selectOpt||{target:a.sendTo,type:1,splitStr:" ",dataUrl:MI.url.userFriends,queryData:{u:MI.user.account,t:"3,2,1"},noResultTip:_("你还没有好友"),noSearchTip:_("没找到匹配的好友，请重新输入"),awaysSetPos:1});a.selectHandler&&a.selectHandler()}});UI.EA(a.sendWord,"focus",function(){a.select.hide()});a.builded=1},buildSlide:function(){var a=this;MI.app({Slide:function(){UI.C(a.giftList,"width",180*a.giftConfig.length+"px");a.slide=new MI.Slide({target:a.giftBox,tmpl:'<%for(var i=0;i<num;i++){%><a href="#" class="<%if(i==0){%>on<%}%>"><%=i+1%></a><%}%>',call:function(b){a.changeGift(b-1)}});a.changeGift(0)}})},selectHandler:function(){var a=this;a.select.pullData(function(b){var c="",d=0;UI.each(b,function(b){13>d&&(c+='<a href="#" data-account="'+b.name+'" title="'+b.nick+'"><img src="'+b.url+'/30"/></a>',a.myFriendArray[b.name]=d);d++});c=c.replace(/src="\/30"/gi,'src="'+MI.picSrc.h30+'"');UI.GT(a.myFriend,"div")[0].innerHTML=c;a.myFriendList=UI.GT(a.myFriend,"a")});UI.EA(a.myFriend,"click",function(b){var b=UI.E(b),c=b.target.nodeName.toLowerCase();if("a"==c||"img"==c){var c="a"==c?b.target:b.target.parentNode,d=UI.A(c,"data-account");UI.hasClass(c,"on")?(UI.removeClass(c,"on"),a.select.unSelectEvent(d),a.changeTalkValue(d,0)):(UI.addClass(c,"on"),a.changeTalkValue(d,1),a.select.selectEvent(d));2!=a.currTab&&a.talkArray[1*a.currTab||0].countTxt();MI.Bos("btnSpringFriendClick")}a.select.selected.num>a.select.max?a.select.show():a.select.hide();b.prevent();b.stop()});a.select.refreshDataEvent=function(b){a.myFriend&&(UI.each(a.myFriendArray,function(c,d){UI.hasKey(b,d)?UI.hasClass(a.myFriendList[c],"on")||(UI.addClass(a.myFriendList[c],"on"),a.changeTalkValue(d,1)):UI.hasClass(a.myFriendList[c],"on")&&(UI.removeClass(a.myFriendList[c],"on"),a.changeTalkValue(d,0))}),UI.each(b,function(b){b=b.name;UI.hasKey(a.myFriendArray,b)||a.changeTalkValue(b,1)}))}},changeTalkValue:function(a,b){var c="@"+a;UI.each(this.talkArray,function(a){if(a){var e=a._txt.value,f=e.hasString(c);b?f||(a._txt.value=(e+" "+c+" ").replace(/  /g," ")):f&&(a._txt.value=e.replace(RegExp(c,"g"),""))}});this.talkArray[this.currTab].countTxt()},changeSelectData:function(a){var b=this,c=a._txt.value.match(b.atReg)||[];UI.each(b.select.selected.data,function(a){a=a.name;UI.has(c,"@"+a)||(b.select.unSelectEvent(a),b.changeTalkValue(a,0))});UI.each(b.select.unSelected.data,function(a){a=a.name;UI.has(c,"@"+a)&&(b.select.selectEvent(a),b.changeTalkValue(a,1))})},bindTalkEvent:function(a,b,c){var d=this,f=new MI.TalkBox(a,{noFlash:c,data:{eventId:d.eventId}}),a=e(a,".sendBtn")[0];f.noRelTopic=1;f.topic=d.topic[b]+" ";f.txtMax=140-MI.countTxt(d.topic[b]);if(11==MI.boss||13==MI.boss)f.addList=1;f.success=function(a){MI.tip(_("发送成功"));d.publishSuccess(a,b)};d.btnValue&&(a.value=d.btnValue);a.onmouseover=function(){this.onclick=function(){d.checkSend(f)&&f.send()}};UI.EA(f._txt,"keyup",function(){d.changeSelectData(f)});return f},changeTab:function(a){var b=this;UI.each(b.tab,function(c,d){a==d?(UI.show(b.div[d]),c.className=c.className.replace(/on$/,"")+"on"):(UI.hide(b.div[d]),c.className=c.className.replace(/on$/,""));1==a?(UI.hide(b.myFriend),b.msgBox.countTxt()):UI.show(b.myFriend);0==a&&(clearTimeout(b.slideDelay),b.slideDelay=setTimeout(function(){b.slide||b.buildSlide()},250))});b.hideWbpmauto();b.currTab=a},bindTabEvent:function(){var a=this;a.tab=UI.GT(a._title,"li");UI.each(a.tab,function(b,c){b.onclick=function(b){c!=a.currTab&&(a.changeTab(c),MI.Bos("btnSpringTabClick"+c),UI.E(b).prevent())}})},checkSend:function(a){var b=(a._txt.value.match(this.atReg)||[]).length||0,c="",d=a._txt.value;a.countTxt();b?b>this.select.max?c=_("一次最多选{0}个好友",this.select.max):d||(c=_("写点祝福语吧！")):c=_("请先选择好友");c&&a.showTip(c,1);return!c},publishSuccess:function(a,b){MI.Bos({name:this.publishBos,iBak1:b,iBak2:a.info&&a.info.talk&&a.info.talk[0]&&a.info.talk[0].id})},changeGift:function(a){this.index=a;if(!this.giftConfig[a])return!1;this.giftName.innerHTML=this.giftConfig[a].name;var b="",c=this.sendWord.value;UI.each(this.giftConfig,function(a){c.hasString(a.word)&&(b=a.word)});b?this.sendWord.value=c.replace(b,this.giftConfig[a].word):UI.trim(c)||(this.sendWord.value=this.giftConfig[a].word);1!=this.eventId&&(this.talk.sourcePic=this.giftConfig[a].pic.replace(/\.png$/,".jpg"));this.talk.countTxt()},reset:function(a){var b=this;UI.each(b.talkArray,function(a,d){a&&(a._txt.value=b.wordingList[d],a.hasMedia()&&(a._txt.value="",a.hideMedia(),a.reset(),a.delPic(),a.delMusic()))});b.msgBox._txt.value="";b.msgBox.countTxt();b.select&&(b.select.resetAllData(),b.select.refreshDataEvent({}),b.sendTo.value=b.placeHolder);b.slide&&(b.changeGift(b.index),b.talk.countTxt());b._wrap||(b._wrap=UI.parents(b.body,"DWrap")[0],b._title=e(b._wrap,".DTitle")[0],b._close=e(b._wrap,".DClose")[0],b._close.onmouseover=function(){b.select&&b.select.hide();b.hideWbpmauto()});b.bindTabEvent();b.changeTab(UI.isUndefined(a)?0:a)},hideWbpmauto:function(){(wbpmauto=e(document.body,".wbpmauto")[0])&&UI.hide(wbpmauto)},show:function(a){var b=this;b.builded||b.build();MI.dialog.show({title:b.domTitle||'<div class="chrisTit"><strong>'+b.title+"</strong></div>",html:b.body,width:580,start:function(){b.reset(a)}})}};MI.sendGiftShow=function(a){MI.app({GiftBox:function(){MI.GiftBox.build(a)}})}})();/*version:97843*//*  |xGv00|afc5abd3b04c19737b331ca8a6c5da03 */